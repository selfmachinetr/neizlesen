<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ne Ä°zlesen â€” Film & Dizi Ä°zle</title>

<!-- SEO -->
<meta name="description" content="Ne Ä°zlesen â€” TÃ¼rkiye'nin en Ã§ok aranan yabancÄ± film ve dizileri tek platformda. Squid Game, Wednesday, Breaking Bad ve daha fazlasÄ±.">
<meta name="keywords" content="film izle, dizi izle, yabancÄ± dizi, netflix dizileri, en iyi filmler, ne izlesem">
<meta name="robots" content="index, follow">

<!-- Open Graph / Facebook -->
<meta property="og:type" content="website">
<meta property="og:url" content="https://neizlesen.com/">
<meta property="og:title" content="Ne Ä°zlesen â€” Film & Dizi Ä°zle">
<meta property="og:description" content="TÃ¼rkiye'nin en Ã§ok aranan yabancÄ± film ve dizileri tek platformda. Squid Game, Wednesday, Breaking Bad ve daha fazlasÄ±.">
<meta property="og:image" content="https://neizlesen.com/og-image.jpg">
<meta property="og:locale" content="tr_TR">
<meta property="og:site_name" content="Ne Ä°zlesen">

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:url" content="https://neizlesen.com/">
<meta name="twitter:title" content="Ne Ä°zlesen â€” Film & Dizi Ä°zle">
<meta name="twitter:description" content="TÃ¼rkiye'nin en Ã§ok aranan yabancÄ± film ve dizileri tek platformda.">
<meta name="twitter:image" content="https://neizlesen.com/og-image.jpg">

<!-- Favicon â€” emoji tabanlÄ± (SVG) -->
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%23e50914'/><text y='.9em' font-size='75' x='12'>ðŸŽ¬</text></svg>">
<link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%23e50914'/><text y='.9em' font-size='75' x='12'>ðŸŽ¬</text></svg>">


<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;1,9..40,300&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #07090e;
  --surface: #0d1017;
  --card: #111520;
  --card2: #161b26;
  --border: rgba(255,255,255,0.065);
  --accent: #e8c840;
  --accent2: #ff4f4f;
  --accent3: #3d9bff;
  --text: #e8eaf0;
  --muted: #6b7280;
  --nav-h: 68px;
  --radius: 12px;
}
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { scroll-behavior: smooth; }
body { background: var(--bg); color: var(--text); font-family: 'DM Sans', sans-serif; font-weight: 300; overflow-x: hidden; cursor: none; min-height: 100vh; }

/* SCROLLBAR */
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: var(--bg); }
::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.12); border-radius: 3px; }
::-webkit-scrollbar-thumb:hover { background: rgba(232,200,64,0.4); }

/* CURSOR */
.cursor-dot { position: fixed; top: 0; left: 0; width: 8px; height: 8px; background: var(--accent); border-radius: 50%; transform: translate(-50%,-50%); pointer-events: none; z-index: 9999; }
.cursor-ring { position: fixed; top: 0; left: 0; width: 36px; height: 36px; border: 1.5px solid rgba(232,200,64,0.45); border-radius: 50%; transform: translate(-50%,-50%); pointer-events: none; z-index: 9998; transition: width .2s, height .2s, border-color .2s, opacity .2s; }
.scroll-prog { position: fixed; top: 0; left: 0; height: 2px; background: linear-gradient(to right, var(--accent), #f0a030); z-index: 10000; box-shadow: 0 0 12px var(--accent); pointer-events: none; }

/* NAV */
nav {
  position: fixed; top: 0; left: 0; right: 0; height: var(--nav-h);
  display: flex; align-items: center; justify-content: space-between;
  padding: 0 48px;
  background: linear-gradient(to bottom, rgba(7,9,14,0.99), transparent);
  z-index: 500; transition: background .3s, border-color .3s;
}
nav.scrolled { background: rgba(7,9,14,0.96); backdrop-filter: blur(24px); border-bottom: 1px solid var(--border); }
.logo { font-family: 'Bebas Neue', sans-serif; font-size: 28px; letter-spacing: 3px; color: var(--accent); text-decoration: none; cursor: none; }
.logo span { color: #fff; }
.nav-links { display: flex; align-items: center; gap: 28px; list-style: none; }
.nav-links a { color: var(--muted); text-decoration: none; font-size: 14px; font-weight: 400; transition: color .2s; position: relative; cursor: none; }
.nav-links a::after { content: ''; position: absolute; bottom: -4px; left: 0; right: 0; height: 1px; background: var(--accent); transform: scaleX(0); transition: transform .2s; }
.nav-links a:hover, .nav-links a.active { color: #fff; }
.nav-links a:hover::after, .nav-links a.active::after { transform: scaleX(1); }
.nav-right { display: flex; align-items: center; gap: 14px; }

/* SEARCH */
.search-wrap { position: relative; }
.search-bar { display: flex; align-items: center; gap: 10px; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 10px; padding: 8px 14px; transition: all .3s; }
.search-bar:focus-within { background: rgba(255,255,255,0.08); border-color: rgba(232,200,64,0.4); box-shadow: 0 0 0 3px rgba(232,200,64,0.07); }
.search-bar input { background: none; border: none; outline: none; color: var(--text); font-family: inherit; font-size: 14px; width: 200px; font-weight: 300; cursor: none; }
.search-bar input::placeholder { color: var(--muted); }
.search-bar svg { color: var(--muted); flex-shrink: 0; }
.search-dropdown { position: absolute; top: calc(100% + 10px); right: 0; width: 360px; background: #13171f; border: 1px solid var(--border); border-radius: 14px; overflow: hidden; box-shadow: 0 24px 64px rgba(0,0,0,0.7); display: none; z-index: 600; }
.sug-header { padding: 12px 16px 8px; font-size: 11px; font-weight: 600; letter-spacing: 1.5px; color: var(--muted); text-transform: uppercase; border-bottom: 1px solid var(--border); }
.sug-item { display: flex; align-items: center; gap: 12px; padding: 11px 16px; cursor: none; transition: background .15s; border-bottom: 1px solid rgba(255,255,255,0.03); }
.sug-item:last-child { border-bottom: none; }
.sug-item:hover { background: rgba(255,255,255,0.04); }
.sug-poster { width: 34px; height: 50px; border-radius: 6px; object-fit: cover; background: var(--card); flex-shrink: 0; }
.sug-info .sug-title { font-size: 14px; color: var(--text); font-weight: 400; }
.sug-info .sug-meta { font-size: 12px; color: var(--muted); margin-top: 2px; }
.sug-type { font-size: 10px; padding: 2px 7px; border-radius: 4px; font-weight: 600; letter-spacing: 1px; margin-left: auto; flex-shrink: 0; }
.sug-type.film { background: rgba(232,200,64,0.12); color: var(--accent); }
.sug-type.dizi { background: rgba(61,155,255,0.12); color: var(--accent3); }

/* AUTH */
.btn-ghost { background: none; border: 1px solid var(--border); color: var(--text); padding: 8px 18px; border-radius: 9px; font-family: inherit; font-size: 14px; cursor: none; transition: all .2s; }
.btn-ghost:hover { border-color: var(--accent); color: var(--accent); }
.btn-primary { background: var(--accent); border: none; color: #080a0f; padding: 8px 18px; border-radius: 9px; font-family: inherit; font-size: 14px; font-weight: 600; cursor: none; transition: all .2s; }
.btn-primary:hover { background: #f0d050; transform: translateY(-1px); box-shadow: 0 4px 20px rgba(232,200,64,0.3); }
.user-chip { display: flex; align-items: center; gap: 10px; cursor: none; }
.user-avatar { width: 36px; height: 36px; border-radius: 50%; background: linear-gradient(135deg, #e8c840, #f0a030); display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 14px; color: #080a0f; flex-shrink: 0; }

/* PAGES */
.page { display: none; min-height: 100vh; padding-top: var(--nav-h); }
.page.active { display: block; }

/* ===== HOME PAGE ===== */
/* HERO */
.hero { position: relative; height: 100vh; min-height: 620px; display: flex; align-items: flex-end; overflow: hidden; }
.hero-bg { position: absolute; inset: 0; }
.hero-bg img { width: 100%; height: 100%; object-fit: cover; display: block; transition: opacity .8s; }
.hero-grad { position: absolute; inset: 0; background: linear-gradient(to top, #07090e 0%, rgba(7,9,14,0.55) 45%, rgba(7,9,14,0.15) 100%), linear-gradient(to right, #07090e 0%, rgba(7,9,14,0.6) 40%, transparent 70%); }
.hero-content { position: relative; z-index: 2; padding: 0 52px 88px; max-width: 680px; }
.hero-badge { display: inline-flex; align-items: center; gap: 8px; background: rgba(232,200,64,0.1); border: 1px solid rgba(232,200,64,0.28); color: var(--accent); font-size: 11px; font-weight: 600; letter-spacing: 2.5px; padding: 6px 14px; border-radius: 5px; margin-bottom: 20px; text-transform: uppercase; }
.hero-badge::before { content: ''; width: 6px; height: 6px; background: var(--accent); border-radius: 50%; animation: blink 2s infinite; }
@keyframes blink { 0%,100%{opacity:1}50%{opacity:.3} }
.hero-title { font-family: 'Bebas Neue', sans-serif; font-size: clamp(52px, 7vw, 96px); line-height: .93; letter-spacing: 2px; margin-bottom: 18px; color: #fff; text-shadow: 0 4px 40px rgba(0,0,0,0.6); }
.hero-title .acc { color: var(--accent); }
.hero-meta { display: flex; align-items: center; gap: 14px; margin-bottom: 14px; flex-wrap: wrap; }
.hero-meta .hm { font-size: 13px; color: rgba(232,234,240,0.65); display: flex; align-items: center; gap: 5px; }
.hero-meta .rating { color: var(--accent); font-weight: 600; font-size: 15px; }
.hero-meta .dot { width: 3px; height: 3px; background: var(--muted); border-radius: 50%; }
.hero-genres { display: flex; gap: 8px; margin-bottom: 18px; flex-wrap: wrap; }
.h-pill { background: rgba(255,255,255,0.07); border: 1px solid rgba(255,255,255,0.12); color: rgba(232,234,240,0.7); font-size: 12px; padding: 4px 14px; border-radius: 100px; }
.hero-desc { font-size: 15px; line-height: 1.72; color: rgba(232,234,240,0.65); max-width: 460px; margin-bottom: 30px; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }
.hero-btns { display: flex; gap: 12px; align-items: center; }
.btn-play { display: flex; align-items: center; gap: 11px; background: var(--accent); color: #07090e; border: none; border-radius: 11px; padding: 13px 28px; font-family: 'Bebas Neue', sans-serif; font-size: 20px; letter-spacing: 2px; cursor: none; transition: all .25s; }
.btn-play:hover { background: #f0d050; transform: translateY(-2px); box-shadow: 0 14px 44px rgba(232,200,64,0.35); }
.btn-detail { display: flex; align-items: center; gap: 10px; background: rgba(255,255,255,0.09); border: 1px solid rgba(255,255,255,0.14); color: #fff; border-radius: 11px; padding: 13px 22px; font-family: inherit; font-size: 15px; cursor: none; transition: all .2s; }
.btn-detail:hover { background: rgba(255,255,255,0.15); }
.hero-nav { position: absolute; bottom: 38px; right: 52px; display: flex; align-items: center; gap: 10px; z-index: 3; }
.h-dot { width: 22px; height: 3px; background: rgba(255,255,255,0.22); border-radius: 2px; cursor: none; transition: all .35s; }
.h-dot.active { width: 38px; background: var(--accent); }
.hero-prev, .hero-next { width: 38px; height: 38px; background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.12); border-radius: 50%; color: #fff; display: flex; align-items: center; justify-content: center; cursor: none; transition: all .2s; }
.hero-prev:hover, .hero-next:hover { background: rgba(232,200,64,0.2); border-color: rgba(232,200,64,0.4); }

/* SECTION */
.sec { padding: 52px 48px; }
.sec-head { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 22px; }
.sec-title { font-family: 'Bebas Neue', sans-serif; font-size: 32px; letter-spacing: 2px; color: #fff; line-height: 1; }
.sec-title span { color: var(--accent); }
.sec-sub { font-size: 13px; color: var(--muted); margin-top: 4px; }
.see-all { font-size: 13px; color: var(--muted); text-decoration: none; display: flex; align-items: center; gap: 5px; cursor: none; transition: color .2s; padding: 6px 0; }
.see-all:hover { color: var(--accent); }

/* HORIZONTAL SCROLL */
.h-scroll-wrap { position: relative; }
.h-scroll { display: flex; gap: 14px; overflow-x: auto; scroll-behavior: smooth; padding-bottom: 12px; scroll-snap-type: x mandatory; -ms-overflow-style: none; scrollbar-width: none; }
.h-scroll::-webkit-scrollbar { display: none; }
.scroll-btn { position: absolute; top: 50%; transform: translateY(-50%); width: 42px; height: 42px; background: rgba(13,16,23,0.92); border: 1px solid var(--border); border-radius: 50%; color: #fff; display: flex; align-items: center; justify-content: center; cursor: none; z-index: 5; transition: all .22s; opacity: 0; }
.h-scroll-wrap:hover .scroll-btn { opacity: 1; }
.scroll-btn:hover { background: rgba(232,200,64,0.18); border-color: rgba(232,200,64,0.4); }
.scroll-btn.left { left: -18px; }
.scroll-btn.right { right: -18px; }

/* FILM CARD (horizontal) */
.film-card { flex-shrink: 0; width: 170px; scroll-snap-align: start; border-radius: var(--radius); overflow: hidden; background: var(--card); cursor: none; transition: transform .3s cubic-bezier(.34,1.56,.64,1); position: relative; }
.film-card:hover { transform: translateY(-8px) scale(1.03); }
.film-card:hover .fc-overlay { opacity: 1; }
.film-card:hover .fc-img { transform: scale(1.06); filter: brightness(.55); }
.fc-wrap { aspect-ratio: 2/3; overflow: hidden; position: relative; }
.fc-img { width: 100%; height: 100%; object-fit: cover; display: block; background: var(--surface); transition: transform .4s, filter .4s; }
.fc-overlay { position: absolute; inset: 0; background: rgba(7,9,14,0.55); display: flex; align-items: center; justify-content: center; opacity: 0; transition: opacity .3s; }
.fc-play { width: 50px; height: 50px; background: var(--accent); border-radius: 50%; display: flex; align-items: center; justify-content: center; transform: scale(.8); transition: transform .3s cubic-bezier(.34,1.56,.64,1); box-shadow: 0 0 28px rgba(232,200,64,0.55); }
.film-card:hover .fc-play { transform: scale(1); }
.fc-rating { position: absolute; top: 9px; right: 9px; background: rgba(7,9,14,0.82); border: 1px solid rgba(232,200,64,0.3); color: var(--accent); font-size: 11px; font-weight: 600; padding: 3px 8px; border-radius: 6px; display: flex; align-items: center; gap: 3px; backdrop-filter: blur(8px); }
.fc-badge { position: absolute; top: 9px; left: 9px; background: rgba(232,200,64,0.16); border: 1px solid rgba(232,200,64,0.32); color: var(--accent); font-size: 9px; font-weight: 700; padding: 2px 7px; border-radius: 4px; letter-spacing: 1px; }
.fc-new { background: rgba(255,79,79,0.16); border: 1px solid rgba(255,79,79,0.35); color: var(--accent2); }
.fc-info { padding: 10px 12px 13px; }
.fc-title { font-size: 13px; font-weight: 500; color: var(--text); margin-bottom: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.fc-meta { font-size: 11px; color: var(--muted); display: flex; gap: 6px; }

/* GRID (full page) */
.film-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(170px, 1fr)); gap: 18px; }

/* SERIES CARD */
.series-card { flex-shrink: 0; width: 300px; scroll-snap-align: start; position: relative; border-radius: 14px; overflow: hidden; cursor: none; aspect-ratio: 16/9; background: var(--card); transition: transform .3s cubic-bezier(.34,1.56,.64,1); }
.series-card:hover { transform: translateY(-6px); }
.series-card:hover .sc-img { transform: scale(1.06); filter: brightness(.45); }
.series-card:hover .sc-play { opacity: 1; transform: translate(-50%,-50%) scale(1); }
.sc-img { width: 100%; height: 100%; object-fit: cover; display: block; background: var(--surface); transition: transform .4s, filter .4s; }
.sc-grad { position: absolute; inset: 0; background: linear-gradient(to top, rgba(7,9,14,.96) 0%, transparent 60%); padding: 18px; display: flex; flex-direction: column; justify-content: flex-end; }
.sc-badge { position: absolute; top: 12px; left: 12px; font-size: 9px; font-weight: 700; letter-spacing: 1.5px; padding: 3px 9px; border-radius: 4px; text-transform: uppercase; }
.sc-badge.new { background: var(--accent2); color: #fff; }
.sc-badge.hot { background: var(--accent); color: #07090e; }
.sc-badge.pop { background: var(--accent3); color: #fff; }
.sc-title { font-family: 'Bebas Neue', sans-serif; font-size: 22px; letter-spacing: 1.5px; color: #fff; margin-bottom: 5px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.sc-meta { font-size: 11px; color: rgba(255,255,255,.5); display: flex; gap: 10px; align-items: center; }
.sc-meta .s-rating { color: var(--accent); font-weight: 600; }
.sc-play { position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%) scale(.7); opacity: 0; transition: all .3s cubic-bezier(.34,1.56,.64,1); width: 54px; height: 54px; background: rgba(232,200,64,.9); border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 0 36px rgba(232,200,64,.5); }

/* STATS */
.stats { background: linear-gradient(to right, var(--surface), rgba(13,16,23,0.6)); border-top: 1px solid var(--border); border-bottom: 1px solid var(--border); padding: 30px 48px; display: grid; grid-template-columns: repeat(4,1fr); }
.stat { text-align: center; padding: 14px; border-right: 1px solid var(--border); }
.stat:last-child { border-right: none; }
.stat-num { font-family: 'Bebas Neue', sans-serif; font-size: 42px; color: var(--accent); letter-spacing: 2px; line-height: 1; margin-bottom: 5px; }
.stat-lbl { font-size: 12px; color: var(--muted); letter-spacing: .5px; }

/* CATEGORY STRIP */
.cat-strip { display: flex; gap: 12px; overflow-x: auto; padding-bottom: 4px; -ms-overflow-style: none; scrollbar-width: none; }
.cat-strip::-webkit-scrollbar { display: none; }
.cat-btn { flex-shrink: 0; display: flex; flex-direction: column; align-items: center; gap: 8px; cursor: none; }
.cat-icon { width: 72px; height: 72px; border-radius: 16px; display: flex; align-items: center; justify-content: center; font-size: 28px; border: 2px solid transparent; transition: all .25s; }
.cat-btn:hover .cat-icon, .cat-btn.active .cat-icon { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(232,200,64,0.15); transform: scale(1.05); }
.cat-lbl { font-size: 12px; color: var(--muted); transition: color .2s; white-space: nowrap; }
.cat-btn:hover .cat-lbl, .cat-btn.active .cat-lbl { color: var(--accent); }

/* FEATURED BANNER */
.featured-banner { position: relative; border-radius: 20px; overflow: hidden; margin: 0 48px; min-height: 220px; display: flex; align-items: center; cursor: none; transition: transform .3s; }
.featured-banner:hover { transform: scale(1.01); }
.fb-bg { position: absolute; inset: 0; object-fit: cover; width: 100%; height: 100%; filter: brightness(.45); }
.fb-grad { position: absolute; inset: 0; background: linear-gradient(to right, rgba(7,9,14,.95), transparent 70%); }
.fb-content { position: relative; z-index: 2; padding: 36px 44px; }
.fb-label { font-size: 11px; font-weight: 600; letter-spacing: 2px; color: var(--accent2); text-transform: uppercase; margin-bottom: 10px; }
.fb-title { font-family: 'Bebas Neue', sans-serif; font-size: 44px; letter-spacing: 2px; color: #fff; margin-bottom: 12px; line-height: 1; }
.fb-sub { font-size: 14px; color: rgba(232,234,240,.65); margin-bottom: 20px; max-width: 340px; }
.btn-sm { display: inline-flex; align-items: center; gap: 8px; background: var(--accent); color: #07090e; border: none; border-radius: 9px; padding: 10px 22px; font-family: 'Bebas Neue', sans-serif; font-size: 17px; letter-spacing: 1.5px; cursor: none; transition: all .22s; }
.btn-sm:hover { background: #f0d050; transform: translateY(-1px); }

/* TABS */
.tabs { display: flex; gap: 8px; margin-bottom: 22px; flex-wrap: wrap; }
.tab-btn { background: none; border: 1px solid var(--border); color: var(--muted); padding: 7px 18px; border-radius: 9px; font-family: inherit; font-size: 13px; cursor: none; transition: all .2s; white-space: nowrap; }
.tab-btn:hover { border-color: rgba(255,255,255,0.22); color: #fff; }
.tab-btn.active { background: var(--accent); border-color: var(--accent); color: #07090e; font-weight: 600; }

/* ===== BROWSE / LIST PAGE ===== */
.browse-header { padding: 36px 48px 28px; border-bottom: 1px solid var(--border); }
.browse-title { font-family: 'Bebas Neue', sans-serif; font-size: 44px; letter-spacing: 2px; color: #fff; margin-bottom: 6px; }
.browse-title span { color: var(--accent); }
.browse-sub { font-size: 14px; color: var(--muted); }
.browse-filters { padding: 20px 48px; display: flex; gap: 12px; flex-wrap: wrap; align-items: center; border-bottom: 1px solid var(--border); }
.filter-select { background: var(--card2); border: 1px solid var(--border); color: var(--text); padding: 9px 14px; border-radius: 9px; font-family: inherit; font-size: 13px; cursor: none; outline: none; transition: border-color .2s; -webkit-appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath fill='%236b7280' d='M1 1l5 5 5-5'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 12px center; padding-right: 32px; }
.filter-select:focus { border-color: rgba(232,200,64,0.4); }
.browse-content { padding: 32px 48px; }
.result-count { font-size: 14px; color: var(--muted); margin-bottom: 22px; }
.result-count strong { color: var(--text); }
.load-more-wrap { text-align: center; padding: 36px 0 8px; }
.btn-load-more { background: var(--card2); border: 1px solid var(--border); color: var(--text); padding: 12px 36px; border-radius: 10px; font-family: inherit; font-size: 14px; cursor: none; transition: all .22s; }
.btn-load-more:hover { border-color: var(--accent); color: var(--accent); }

/* ===== DETAIL / WATCH PAGE ===== */
.detail-hero { position: relative; min-height: 60vh; display: flex; align-items: flex-end; overflow: hidden; }
.dh-bg { position: absolute; inset: 0; }
.dh-bg img { width: 100%; height: 100%; object-fit: cover; display: block; }
.dh-grad { position: absolute; inset: 0; background: linear-gradient(to top, #07090e 0%, rgba(7,9,14,0.6) 50%, rgba(7,9,14,0.2) 100%), linear-gradient(to right, #07090e 0%, rgba(7,9,14,0.5) 40%, transparent 65%); }
.dh-content { position: relative; z-index: 2; padding: 0 52px 52px; display: flex; gap: 40px; align-items: flex-end; }
.dh-poster { width: 190px; flex-shrink: 0; border-radius: 14px; overflow: hidden; box-shadow: 0 24px 60px rgba(0,0,0,0.8); border: 1px solid rgba(255,255,255,0.08); }
.dh-poster img { width: 100%; display: block; }
.dh-info { flex: 1; }
.dh-type { font-size: 11px; font-weight: 700; letter-spacing: 2.5px; color: var(--accent); text-transform: uppercase; margin-bottom: 12px; }
.dh-title { font-family: 'Bebas Neue', sans-serif; font-size: clamp(38px, 5vw, 72px); letter-spacing: 2px; color: #fff; line-height: .95; margin-bottom: 14px; }
.dh-meta { display: flex; align-items: center; gap: 14px; flex-wrap: wrap; margin-bottom: 14px; }
.dh-meta .dm { font-size: 13px; color: var(--muted); display: flex; align-items: center; gap: 5px; }
.dh-meta .dm.rating { color: var(--accent); font-size: 15px; font-weight: 700; }
.dh-genres-row { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 18px; }
.dh-genre { background: rgba(255,255,255,0.06); border: 1px solid var(--border); color: rgba(232,234,240,0.65); font-size: 12px; padding: 4px 14px; border-radius: 100px; cursor: none; transition: all .2s; }
.dh-genre:hover { background: rgba(232,200,64,0.1); border-color: rgba(232,200,64,0.3); color: var(--accent); }
.dh-overview { font-size: 15px; line-height: 1.75; color: rgba(232,234,240,0.68); max-width: 580px; margin-bottom: 12px; }
.dh-director { font-size: 13px; margin-bottom: 24px; }
.dh-dir-label { color: var(--muted); margin-right: 6px; }
.dh-dir-name { color: var(--accent); font-weight: 500; cursor: none; }
.dh-btns { display: flex; gap: 12px; flex-wrap: wrap; }
.btn-watch-big { display: flex; align-items: center; gap: 12px; background: var(--accent); color: #07090e; border: none; border-radius: 11px; padding: 14px 30px; font-family: 'Bebas Neue', sans-serif; font-size: 22px; letter-spacing: 2px; cursor: none; transition: all .25s; }
.btn-watch-big:hover { background: #f0d050; transform: translateY(-2px); box-shadow: 0 14px 44px rgba(232,200,64,0.4); }
.btn-list { display: flex; align-items: center; gap: 9px; background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.14); color: #fff; border-radius: 11px; padding: 14px 22px; font-family: inherit; font-size: 14px; cursor: none; transition: all .2s; }
.btn-list:hover { background: rgba(255,255,255,0.14); }
.btn-list.added { border-color: rgba(232,200,64,0.4); color: var(--accent); }

/* DETAIL BODY */
.detail-body { padding: 48px 52px; }
.detail-grid { display: grid; grid-template-columns: 1fr 300px; gap: 52px; }
.detail-left {}
.detail-right {}
.cast-grid { display: flex; gap: 14px; flex-wrap: wrap; margin-top: 16px; }
.cast-item { display: flex; flex-direction: column; align-items: center; gap: 6px; width: 80px; cursor: none; transition: transform .2s; }
.cast-item:hover { transform: translateY(-4px); }
.cast-item:hover .cast-img { border-color: var(--accent); }
.cast-img { width: 64px; height: 64px; border-radius: 50%; object-fit: cover; background: var(--card2); border: 2px solid var(--border); transition: border-color .2s; }
.cast-name { font-size: 11px; color: var(--text); text-align: center; line-height: 1.3; font-weight: 500; }
.cast-char { font-size: 10px; color: var(--muted); text-align: center; line-height: 1.2; }

.info-card { background: var(--card); border: 1px solid var(--border); border-radius: 14px; padding: 22px; margin-bottom: 18px; }
.info-card h4 { font-size: 12px; font-weight: 600; letter-spacing: 1.5px; color: var(--muted); text-transform: uppercase; margin-bottom: 14px; }
.info-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--border); font-size: 13px; }
.info-row:last-child { border-bottom: none; }
.info-row .ir-key { color: var(--muted); }
.info-row .ir-val { color: var(--text); text-align: right; max-width: 60%; }

/* VIDEO PLAYER */
.player-section { background: #000; position: relative; }
.player-layout { display: grid; grid-template-columns: 1fr 340px; background: #000; min-height: 0; }
.player-main { display: flex; flex-direction: column; min-width: 0; }
.player-wrap { position: relative; aspect-ratio: 16/9; background: #000; display: flex; align-items: center; justify-content: center; overflow: hidden; }
.player-iframe { width: 100%; height: 100%; border: none; position: absolute; inset: 0; display: block; }
.player-splash { position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; background: #000; z-index: 2; cursor: none; }
.player-splash-bg { position: absolute; inset: 0; object-fit: cover; width: 100%; height: 100%; opacity: .22; filter: blur(14px) brightness(.5); }
.player-splash-content { position: relative; z-index: 3; text-align: center; display: flex; flex-direction: column; align-items: center; }
.splash-play-btn { width: 84px; height: 84px; background: var(--accent); border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: none; transition: all .25s cubic-bezier(.34,1.56,.64,1); box-shadow: 0 0 0 0 rgba(232,200,64,.4); margin-bottom: 22px; border: none; }
.splash-play-btn:hover { transform: scale(1.12); box-shadow: 0 0 0 18px rgba(232,200,64,.12), 0 0 44px rgba(232,200,64,.28); }
.splash-title { font-family: 'Bebas Neue', sans-serif; font-size: clamp(26px, 4vw, 48px); letter-spacing: 2px; color: #fff; margin-bottom: 10px; text-shadow: 0 2px 20px rgba(0,0,0,.8); }
.splash-meta { font-size: 14px; color: rgba(255,255,255,.5); margin-bottom: 4px; }
.splash-ep-label { font-size: 13px; color: var(--accent); font-weight: 500; margin-top: 6px; }
.progress-bar-wrap { height: 3px; background: rgba(255,255,255,.07); }
.progress-bar-fill { height: 100%; background: linear-gradient(to right, var(--accent), #f0a030); transition: width .6s linear; width: 0%; }
.player-controls { background: #080b11; padding: 13px 22px; display: flex; align-items: center; justify-content: space-between; border-top: 1px solid rgba(255,255,255,.05); gap: 16px; }
/* Player Sidebar */
.player-sidebar { background: #0a0d14; border-left: 1px solid rgba(255,255,255,.07); display: flex; flex-direction: column; overflow: hidden; }
.ps-header { display: flex; align-items: center; justify-content: space-between; padding: 14px 16px; border-bottom: 1px solid rgba(255,255,255,.07); flex-shrink: 0; }
.ps-title { font-family: 'Bebas Neue', sans-serif; font-size: 16px; letter-spacing: 2px; color: var(--text); }
.ps-season-select { background: var(--card); border: 1px solid var(--border); color: var(--text); font-size: 12px; padding: 4px 8px; border-radius: 6px; font-family: inherit; cursor: none; }
.ps-ep-list { overflow-y: auto; flex: 1; padding: 8px 0; scrollbar-width: thin; scrollbar-color: var(--border) transparent; }
.ps-ep-item { display: flex; gap: 10px; padding: 8px 14px; cursor: none; transition: background .15s; border-left: 2px solid transparent; }
.ps-ep-item:hover { background: rgba(255,255,255,.04); }
.ps-ep-item.active { background: rgba(232,200,64,.06); border-left-color: var(--accent); }
.ps-ep-thumb { width: 88px; height: 52px; object-fit: cover; border-radius: 5px; flex-shrink: 0; background: var(--card2); }
.ps-ep-info { flex: 1; min-width: 0; display: flex; flex-direction: column; justify-content: center; gap: 3px; }
.ps-ep-num { font-size: 10px; color: var(--accent); font-weight: 600; letter-spacing: 1px; }
.ps-ep-name { font-size: 12px; color: var(--text); font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.ps-ep-meta { font-size: 11px; color: var(--muted); }
/* Sidebar film listesi */
.ps-sim-list { overflow-y: auto; flex: 1; padding: 8px 0; scrollbar-width: thin; scrollbar-color: var(--border) transparent; }
.ps-sim-item { display: flex; gap: 10px; padding: 8px 14px; cursor: none; transition: background .15s; }
.ps-sim-item:hover { background: rgba(255,255,255,.04); }
.ps-sim-img { width: 56px; height: 80px; object-fit: cover; border-radius: 5px; flex-shrink: 0; background: var(--card2); }
.ps-sim-info { flex: 1; min-width: 0; display: flex; flex-direction: column; justify-content: center; gap: 4px; }
.ps-sim-title { font-size: 13px; color: var(--text); font-weight: 500; line-height: 1.3; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
.ps-sim-meta { font-size: 11px; color: var(--muted); }
.pc-left { display: flex; align-items: center; gap: 12px; min-width: 0; flex: 1; }
.pc-title { font-size: 14px; font-weight: 500; color: var(--text); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.pc-meta { font-size: 12px; color: var(--muted); white-space: nowrap; }
.pc-progress-text { font-size: 12px; color: var(--accent); font-weight: 500; white-space: nowrap; }
.pc-right { display: flex; align-items: center; gap: 8px; flex-shrink: 0; }

/* SIMILAR */
.similar-sec { padding: 44px 52px; border-top: 1px solid var(--border); }

/* MODALS */
.modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.82); z-index: 1000; display: flex; align-items: center; justify-content: center; opacity: 0; visibility: hidden; transition: all .3s; backdrop-filter: blur(10px); }
.modal-overlay.open { opacity: 1; visibility: visible; }
.modal { background: #12161e; border: 1px solid var(--border); border-radius: 20px; overflow: hidden; transform: scale(.92) translateY(20px); transition: transform .35s cubic-bezier(.34,1.56,.64,1); position: relative; }
.modal-overlay.open .modal { transform: scale(1) translateY(0); }
.modal-x { position: absolute; top: 14px; right: 14px; width: 34px; height: 34px; background: rgba(255,255,255,0.09); border: none; border-radius: 50%; color: var(--text); font-size: 16px; display: flex; align-items: center; justify-content: center; cursor: none; transition: background .2s; z-index: 5; }
.modal-x:hover { background: rgba(255,255,255,0.18); }

/* AUTH MODAL */
.auth-modal { width: 440px; max-width: 96vw; }
.am-head { padding: 36px 40px 26px; text-align: center; border-bottom: 1px solid var(--border); }
.am-logo { font-family: 'Bebas Neue', sans-serif; font-size: 26px; letter-spacing: 3px; color: var(--accent); margin-bottom: 6px; }
.am-logo span { color: #fff; }
.am-sub { font-size: 14px; color: var(--muted); }
.am-tabs { display: flex; border-bottom: 1px solid var(--border); }
.am-tab { flex: 1; padding: 15px; text-align: center; font-size: 14px; color: var(--muted); cursor: none; background: none; border: none; border-bottom: 2px solid transparent; margin-bottom: -1px; transition: all .2s; font-family: inherit; }
.am-tab.active { color: var(--accent); border-bottom-color: var(--accent); }
.am-body { padding: 28px 36px 36px; }
.fg { margin-bottom: 18px; }
.fg label { display: block; font-size: 11px; font-weight: 600; color: var(--muted); letter-spacing: .5px; margin-bottom: 7px; text-transform: uppercase; }
.fg input { width: 100%; background: rgba(255,255,255,0.04); border: 1px solid var(--border); border-radius: 10px; padding: 12px 14px; color: var(--text); font-family: inherit; font-size: 15px; outline: none; transition: all .2s; }
.fg input:focus { border-color: rgba(232,200,64,0.5); box-shadow: 0 0 0 3px rgba(232,200,64,0.07); background: rgba(255,255,255,0.06); }
.fg input::placeholder { color: var(--muted); }
.btn-auth { width: 100%; padding: 14px; background: var(--accent); border: none; border-radius: 10px; font-family: 'Bebas Neue', sans-serif; font-size: 20px; letter-spacing: 2px; color: #07090e; cursor: none; transition: all .25s; margin-top: 6px; }
.btn-auth:hover { background: #f0d050; box-shadow: 0 8px 30px rgba(232,200,64,0.28); }
.am-err { background: rgba(255,79,79,.1); border: 1px solid rgba(255,79,79,.3); color: #ff6b6b; border-radius: 8px; padding: 10px 13px; font-size: 13px; margin-bottom: 14px; display: none; }
.am-link { font-size: 13px; color: var(--muted); text-align: center; margin-top: 14px; }
.am-link a { color: var(--accent); text-decoration: none; }

/* TOAST */
.toast { position: fixed; bottom: 28px; right: 28px; background: #1a1e28; border: 1px solid var(--border); border-left: 3px solid var(--accent); border-radius: 12px; padding: 14px 18px; font-size: 14px; color: var(--text); z-index: 9999; transform: translateX(130%); transition: transform .35s cubic-bezier(.34,1.56,.64,1); max-width: 320px; box-shadow: 0 12px 40px rgba(0,0,0,0.5); }
.toast.show { transform: translateX(0); }
.toast.err { border-left-color: var(--accent2); }

/* LOADING */
.skeleton { background: linear-gradient(90deg, var(--card) 25%, rgba(255,255,255,0.04) 50%, var(--card) 75%); background-size: 200% 100%; animation: shimmer 1.6s infinite; border-radius: var(--radius); }
@keyframes shimmer { 0%{background-position:200% 0}100%{background-position:-200% 0} }
.spinner { width: 40px; height: 40px; border: 3px solid var(--border); border-top-color: var(--accent); border-radius: 50%; animation: spin .8s linear infinite; margin: 60px auto; }
@keyframes spin { to{transform:rotate(360deg)} }

/* HERO ANIMATIONS */
@keyframes fadeUp { from{opacity:0;transform:translateY(28px)}to{opacity:1;transform:translateY(0)} }
.hero-content > * { animation: fadeUp .6s both; }
.hero-content > *:nth-child(1){animation-delay:.1s}
.hero-content > *:nth-child(2){animation-delay:.25s}
.hero-content > *:nth-child(3){animation-delay:.38s}
.hero-content > *:nth-child(4){animation-delay:.44s}
.hero-content > *:nth-child(5){animation-delay:.5s}
.hero-content > *:nth-child(6){animation-delay:.62s}

/* SEASONS & EPISODES */
.seasons-section { padding: 0 52px 52px; }
.seasons-title { font-family: 'Bebas Neue', sans-serif; font-size: 30px; letter-spacing: 2px; color: #fff; margin-bottom: 20px; }
.seasons-title span { color: var(--accent); }
.season-tabs-row { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 28px; overflow-x: auto; padding-bottom: 4px; -ms-overflow-style: none; scrollbar-width: none; }
.season-tabs-row::-webkit-scrollbar { display: none; }
.season-tab { flex-shrink: 0; background: var(--card2); border: 1px solid var(--border); color: var(--muted); padding: 8px 20px; border-radius: 9px; font-family: inherit; font-size: 13px; cursor: none; transition: all .2s; white-space: nowrap; }
.season-tab:hover { border-color: rgba(255,255,255,.22); color: #fff; }
.season-tab.active { background: rgba(232,200,64,.12); border-color: rgba(232,200,64,.4); color: var(--accent); font-weight: 500; }
.season-info-bar { display: flex; align-items: center; gap: 20px; padding: 18px 22px; background: var(--card); border: 1px solid var(--border); border-radius: 14px 14px 0 0; margin-bottom: 2px; }
.season-poster { width: 60px; height: 90px; border-radius: 8px; object-fit: cover; background: var(--card2); flex-shrink: 0; }
.season-info-text .si-name { font-family: 'Bebas Neue', sans-serif; font-size: 22px; letter-spacing: 1.5px; color: #fff; margin-bottom: 4px; }
.season-info-text .si-meta { font-size: 13px; color: var(--muted); display: flex; gap: 14px; }
.season-info-text .si-overview { font-size: 13px; color: rgba(232,234,240,.6); margin-top: 6px; line-height: 1.6; max-width: 600px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
.episodes-list { display: flex; flex-direction: column; gap: 2px; }
.episode-card { display: flex; align-items: center; gap: 18px; padding: 14px 20px; background: var(--card); border: 1px solid var(--border); border-top: none; cursor: none; transition: background .2s; }
.episode-card:last-child { border-radius: 0 0 14px 14px; }
.episode-card:hover { background: var(--card2); }
.episode-card:hover .ep-play-icon { opacity: 1; transform: scale(1); }
.ep-num { font-family: 'Bebas Neue', sans-serif; font-size: 22px; color: var(--muted); width: 36px; flex-shrink: 0; text-align: center; line-height: 1; }
.ep-thumb-wrap { position: relative; flex-shrink: 0; }
.ep-thumb { width: 140px; height: 80px; border-radius: 8px; object-fit: cover; background: var(--card2); display: block; }
.ep-play-icon { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; background: rgba(7,9,14,.6); border-radius: 8px; opacity: 0; transform: scale(.9); transition: all .22s; }
.ep-play-icon svg { filter: drop-shadow(0 0 8px rgba(232,200,64,.6)); }
.ep-info { flex: 1; min-width: 0; }
.ep-title { font-size: 15px; font-weight: 500; color: var(--text); margin-bottom: 5px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.ep-meta { font-size: 12px; color: var(--muted); display: flex; gap: 10px; margin-bottom: 5px; }
.ep-overview { font-size: 13px; color: rgba(232,234,240,.55); line-height: 1.5; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
.ep-rating { flex-shrink: 0; font-size: 13px; color: var(--accent); font-weight: 600; display: flex; align-items: center; gap: 4px; }
.ep-loading { padding: 40px; text-align: center; }
@keyframes epFadeIn { from{opacity:0;transform:translateY(10px)} to{opacity:1;transform:translateY(0)} }
.episode-card { animation: epFadeIn .3s both; }

/* ===== LIGHT THEME ===== */
body.light {
  --bg: #f0f2f5; --surface: #e4e8ef; --card: #fff; --card2: #f7f9fc;
  --border: rgba(0,0,0,0.08); --text: #141820; --muted: #7a8494;
}
body.light ::-webkit-scrollbar-track { background: var(--bg); }
body.light nav { background: rgba(240,242,245,0.97); }
body.light .search-bar { background: rgba(0,0,0,0.05); }
body.light .search-dropdown { background: #fff; }
body.light .sug-item:hover { background: rgba(0,0,0,0.03); }
body.light .mobile-menu { background: #fff; }
body.light .film-card, body.light .series-card { box-shadow: 0 2px 12px rgba(0,0,0,0.08); }
body.light .info-card { box-shadow: 0 2px 12px rgba(0,0,0,0.06); }

/* ===== HAMBURGER ===== */
.hamburger-btn { display: none; flex-direction: column; gap: 5px; background: none; border: none; cursor: none; padding: 8px; }
.hamburger-btn span { display: block; width: 22px; height: 2px; background: var(--text); border-radius: 2px; transition: all .3s; }
.nav-icon-btn { background: none; border: 1px solid var(--border); border-radius: 8px; padding: 6px 10px; font-size: 16px; cursor: none; transition: all .2s; color: var(--text); }
.nav-icon-btn:hover { border-color: var(--accent); transform: scale(1.1); }

/* ===== MOBILE MENU ===== */
.mobile-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 900; opacity: 0; visibility: hidden; transition: all .3s; backdrop-filter: blur(4px); }
.mobile-overlay.open { opacity: 1; visibility: visible; }
.mobile-menu { position: fixed; top: 0; right: 0; bottom: 0; width: 300px; background: var(--surface); z-index: 901; transform: translateX(100%); transition: transform .35s cubic-bezier(.4,0,.2,1); padding: 0; display: flex; flex-direction: column; box-shadow: -20px 0 60px rgba(0,0,0,0.5); }
.mobile-menu.open { transform: translateX(0); }
.mm-head { display: flex; align-items: center; justify-content: space-between; padding: 20px 24px; border-bottom: 1px solid var(--border); }
.mm-logo { font-family: 'Bebas Neue', sans-serif; font-size: 24px; letter-spacing: 3px; color: var(--accent); }
.mm-logo span { color: var(--text); }
.mm-close { background: none; border: none; color: var(--muted); font-size: 20px; cursor: none; padding: 4px; }
.mm-user { padding: 16px 24px; border-bottom: 1px solid var(--border); min-height: 60px; display: flex; align-items: center; gap: 12px; }
.mm-user .mu-avatar { width: 42px; height: 42px; border-radius: 50%; background: linear-gradient(135deg, var(--accent), #f0a030); display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 16px; color: #080a0f; flex-shrink: 0; }
.mm-user .mu-name { font-size: 15px; font-weight: 500; color: var(--text); }
.mm-user .mu-email { font-size: 12px; color: var(--muted); }
.mm-nav { flex: 1; padding: 12px 0; overflow-y: auto; }
.mm-nav a { display: flex; align-items: center; gap: 14px; padding: 14px 24px; color: var(--muted); text-decoration: none; font-size: 15px; transition: all .2s; border-left: 3px solid transparent; }
.mm-nav a:hover { color: var(--text); background: rgba(232,200,64,.06); border-left-color: var(--accent); padding-left: 28px; }
.mm-theme { padding: 16px 24px; border-top: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; }
.theme-toggle-btn { background: var(--card); border: 1px solid var(--border); color: var(--text); padding: 8px 14px; border-radius: 8px; font-family: inherit; font-size: 13px; cursor: none; transition: all .2s; }
.theme-toggle-btn:hover { border-color: var(--accent); color: var(--accent); }

/* ===== TRAILER MODAL ===== */
.trailer-modal { width: 900px; max-width: 96vw; background: #000; }
.trailer-titlebar { padding: 14px 20px; background: #0a0c12; font-family: 'Bebas Neue', sans-serif; font-size: 18px; letter-spacing: 1px; color: #fff; border-bottom: 1px solid var(--border); }
.trailer-wrap { position: relative; aspect-ratio: 16/9; }
.trailer-iframe { position: absolute; inset: 0; width: 100%; height: 100%; border: none; display: block; }

/* ===== SEARCH PAGE ===== */
.search-page-header { padding: 36px 48px 28px; }
.search-page-query { font-family: 'Bebas Neue', sans-serif; font-size: 40px; letter-spacing: 2px; color: #fff; margin-bottom: 6px; }
.search-page-query span { color: var(--accent); }
.search-page-sub { font-size: 14px; color: var(--muted); }
.search-filter-row { display: flex; gap: 8px; padding: 0 48px 24px; flex-wrap: wrap; }
.sf-btn { background: var(--card2); border: 1px solid var(--border); color: var(--muted); padding: 7px 18px; border-radius: 9px; font-family: inherit; font-size: 13px; cursor: none; transition: all .2s; }
.sf-btn.active { background: var(--accent); border-color: var(--accent); color: #07090e; font-weight: 600; }
.sf-btn:hover:not(.active) { border-color: rgba(255,255,255,.2); color: var(--text); }

/* ===== PROFILE PAGE ===== */
.profile-header { padding: 52px 52px 36px; display: flex; align-items: flex-end; gap: 32px; border-bottom: 1px solid var(--border); }
.profile-avatar-wrap { position: relative; flex-shrink: 0; }
.profile-avatar { width: 100px; height: 100px; border-radius: 50%; background: linear-gradient(135deg, var(--accent), #f0a030); display: flex; align-items: center; justify-content: center; font-family: 'Bebas Neue', sans-serif; font-size: 40px; color: #07090e; border: 3px solid var(--border); }
.profile-info .p-name { font-family: 'Bebas Neue', sans-serif; font-size: 40px; letter-spacing: 2px; color: #fff; line-height: 1; margin-bottom: 6px; }
.profile-info .p-email { font-size: 14px; color: var(--muted); margin-bottom: 16px; }
.profile-stats { display: flex; gap: 28px; }
.ps-item { text-align: center; }
.ps-num { font-family: 'Bebas Neue', sans-serif; font-size: 28px; color: var(--accent); letter-spacing: 1px; }
.ps-lbl { font-size: 12px; color: var(--muted); }
.profile-body { padding: 36px 52px; display: grid; grid-template-columns: 1fr 320px; gap: 40px; }
.profile-section-title { font-family: 'Bebas Neue', sans-serif; font-size: 24px; letter-spacing: 1.5px; color: #fff; margin-bottom: 16px; }
.profile-section-title span { color: var(--accent); }
.rating-history-item { display: flex; align-items: center; gap: 14px; padding: 12px 0; border-bottom: 1px solid var(--border); cursor: none; transition: background .15s; }
.rating-history-item:last-child { border-bottom: none; }
.rhi-poster { width: 40px; height: 60px; border-radius: 6px; object-fit: cover; background: var(--card2); flex-shrink: 0; }
.rhi-info { flex: 1; min-width: 0; }
.rhi-title { font-size: 14px; font-weight: 500; color: var(--text); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.rhi-meta { font-size: 12px; color: var(--muted); margin-top: 3px; }
.rhi-stars { color: var(--accent); font-size: 14px; flex-shrink: 0; }
.profile-edit-card { background: var(--card); border: 1px solid var(--border); border-radius: 14px; padding: 24px; }
.profile-edit-card h4 { font-size: 13px; font-weight: 600; letter-spacing: 1px; color: var(--muted); text-transform: uppercase; margin-bottom: 18px; }
.avatar-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 18px; }
.avatar-opt { width: 100%; aspect-ratio: 1; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 22px; cursor: none; border: 2px solid transparent; transition: all .2s; }
.avatar-opt:hover { transform: scale(1.1); border-color: var(--accent); }
.avatar-opt.selected { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(232,200,64,.2); }

/* ===== STAR RATING ===== */
.star-rating { display: flex; gap: 4px; }
.star { font-size: 20px; color: var(--muted); cursor: none; transition: color .15s, transform .15s; }
.star:hover, .star.active { color: var(--accent); transform: scale(1.2); }
.rating-widget { background: var(--card); border: 1px solid var(--border); border-radius: 14px; padding: 20px 22px; margin-top: 24px; }
.rating-widget h4 { font-size: 13px; font-weight: 600; letter-spacing: 1px; color: var(--muted); text-transform: uppercase; margin-bottom: 14px; }
.review-input { width: 100%; background: rgba(255,255,255,.04); border: 1px solid var(--border); border-radius: 10px; padding: 12px 14px; color: var(--text); font-family: inherit; font-size: 14px; resize: vertical; min-height: 80px; outline: none; margin-top: 12px; transition: border-color .2s; }
.review-input:focus { border-color: rgba(232,200,64,.4); }
.review-input::placeholder { color: var(--muted); }
.review-list { margin-top: 24px; }
.review-item { padding: 16px 0; border-bottom: 1px solid var(--border); }
.review-item:last-child { border-bottom: none; }
.ri-header { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; }
.ri-avatar { width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(135deg, var(--accent), #f0a030); display: flex; align-items: center; justify-content: center; font-size: 13px; font-weight: 700; color: #07090e; flex-shrink: 0; }
.ri-name { font-size: 14px; font-weight: 500; color: var(--text); }
.ri-date { font-size: 11px; color: var(--muted); margin-left: auto; }
.ri-stars { color: var(--accent); font-size: 13px; }
.ri-text { font-size: 14px; color: rgba(232,234,240,.7); line-height: 1.6; }

/* ===== WATCH HISTORY ===== */
.history-item { display: flex; align-items: center; gap: 14px; padding: 12px 0; border-bottom: 1px solid var(--border); cursor: none; }
.history-item:last-child { border-bottom: none; }
.hi-poster { width: 40px; height: 60px; border-radius: 6px; object-fit: cover; background: var(--card2); flex-shrink: 0; }
.hi-info { flex: 1; min-width: 0; }
.hi-title { font-size: 14px; font-weight: 500; color: var(--text); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.hi-meta { font-size: 12px; color: var(--muted); margin-top: 3px; }
.hi-progress { height: 3px; background: var(--border); border-radius: 2px; margin-top: 6px; }
.hi-progress-fill { height: 100%; background: var(--accent); border-radius: 2px; }

/* ===== CALENDAR PAGE ===== */
.calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; margin-bottom: 32px; }
.cal-day-header { text-align: center; padding: 8px 4px; font-size: 11px; font-weight: 600; letter-spacing: 1px; color: var(--muted); text-transform: uppercase; }
.cal-day { background: var(--card); border: 1px solid var(--border); border-radius: 8px; min-height: 90px; padding: 8px; transition: border-color .2s; }
.cal-day.today { border-color: var(--accent); }
.cal-day.other-month { opacity: .35; }
.cal-day-num { font-size: 13px; color: var(--muted); margin-bottom: 6px; font-weight: 500; }
.cal-day.today .cal-day-num { color: var(--accent); font-weight: 700; }
.cal-ep { background: rgba(232,200,64,.12); border-left: 2px solid var(--accent); border-radius: 3px; padding: 3px 6px; font-size: 10px; color: var(--accent); margin-bottom: 3px; cursor: none; transition: background .15s; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.cal-ep:hover { background: rgba(232,200,64,.22); }
.cal-ep.tv3 { background: rgba(61,155,255,.12); border-left-color: var(--accent3); color: var(--accent3); }
.cal-ep.tv3:hover { background: rgba(61,155,255,.22); }
.upcoming-list { display: flex; flex-direction: column; gap: 12px; }
.upcoming-item { display: flex; align-items: center; gap: 16px; padding: 14px 18px; background: var(--card); border: 1px solid var(--border); border-radius: 12px; cursor: none; transition: border-color .2s; }
.upcoming-item:hover { border-color: rgba(232,200,64,.3); }
.ui-date { text-align: center; flex-shrink: 0; width: 48px; }
.ui-day { font-family: 'Bebas Neue', sans-serif; font-size: 26px; color: var(--accent); line-height: 1; }
.ui-month { font-size: 10px; color: var(--muted); text-transform: uppercase; letter-spacing: 1px; }
.ui-poster { width: 36px; height: 54px; border-radius: 6px; object-fit: cover; background: var(--card2); flex-shrink: 0; }
.ui-info { flex: 1; min-width: 0; }
.ui-show { font-size: 15px; font-weight: 500; color: var(--text); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.ui-ep { font-size: 12px; color: var(--muted); margin-top: 3px; }
.ui-badge { font-size: 10px; padding: 3px 9px; border-radius: 4px; font-weight: 600; letter-spacing: 1px; flex-shrink: 0; }
.ui-badge.new { background: rgba(255,79,79,.15); color: var(--accent2); border: 1px solid rgba(255,79,79,.3); }
.ui-badge.soon { background: rgba(61,155,255,.15); color: var(--accent3); border: 1px solid rgba(61,155,255,.3); }

/* ===== PERSON PAGE ===== */
.person-header { padding: 52px 52px 36px; display: flex; gap: 40px; align-items: flex-start; border-bottom: 1px solid var(--border); }
.person-photo { width: 150px; height: 225px; border-radius: 14px; object-fit: cover; background: var(--card2); flex-shrink: 0; box-shadow: 0 20px 60px rgba(0,0,0,.6); }
.person-info { flex: 1; }
.person-name { font-family: 'Bebas Neue', sans-serif; font-size: 52px; letter-spacing: 2px; color: #fff; line-height: .95; margin-bottom: 12px; }
.person-dept { font-size: 13px; color: var(--accent); font-weight: 500; letter-spacing: 1px; text-transform: uppercase; margin-bottom: 12px; }
.person-bio { font-size: 15px; color: rgba(232,234,240,.65); line-height: 1.72; max-width: 600px; display: -webkit-box; -webkit-line-clamp: 5; -webkit-box-orient: vertical; overflow: hidden; }
.person-meta-grid { display: flex; gap: 24px; margin-top: 18px; flex-wrap: wrap; }
.pm-item { font-size: 13px; color: var(--muted); }
.pm-item strong { color: var(--text); display: block; font-size: 14px; margin-bottom: 2px; }

/* ===== 404 PAGE ===== */
.page-404 { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 80vh; text-align: center; padding: 48px; }
.p404-num { font-family: 'Bebas Neue', sans-serif; font-size: 140px; color: var(--accent); letter-spacing: 8px; line-height: 1; opacity: .15; margin-bottom: -20px; }
.p404-title { font-family: 'Bebas Neue', sans-serif; font-size: 36px; letter-spacing: 2px; color: #fff; margin-bottom: 12px; }
.p404-sub { font-size: 15px; color: var(--muted); max-width: 380px; line-height: 1.7; margin-bottom: 28px; }

/* MOBILE RESPONSIVE */
@media(max-width:900px){
  .hamburger-btn { display: flex; }
  .nav-links { display: none !important; }
  .search-bar input { width: 120px; }
  #authBtns { display: none !important; }
  nav { padding: 0 16px; }
  .sec,.browse-header,.browse-filters,.browse-content,.detail-body,.similar-sec,.seasons-section,.profile-header,.profile-body,.person-header { padding-left: 16px; padding-right: 16px; }
  .hero-content { padding: 0 16px 60px; }
  .stats { grid-template-columns: repeat(2,1fr); padding: 16px; }
  .film-grid { grid-template-columns: repeat(auto-fill,minmax(130px,1fr)); }
  .detail-grid { grid-template-columns: 1fr; }
  .dh-content { flex-direction: column; align-items: flex-start; gap: 20px; padding: 0 16px 32px; }
  .dh-poster { width: 100px; }
  .dh-title { font-size: 28px; }
  .dh-overview { font-size: 13px; -webkit-line-clamp: 4; }
  .dh-btns { flex-wrap: wrap; gap: 8px; }
  .btn-watch-big { width: 100%; justify-content: center; }
  .featured-banner { margin: 0 16px; }
  .profile-header { flex-direction: column; padding: 32px 16px 24px; }
  .profile-body { grid-template-columns: 1fr; }
  .person-header { flex-direction: column; padding: 32px 16px; }
  .person-photo { width: 120px; height: 180px; }
  .calendar-grid { grid-template-columns: repeat(7,1fr); gap: 1px; }
  .cal-day { min-height: 60px; padding: 4px; }
  .search-dropdown { width: 300px; right: -60px; }
  .cast-grid { gap: 10px; }
  .cast-item { width: 68px; }
  .cast-img { width: 56px; height: 56px; }
  .player-layout { grid-template-columns: 1fr; }
  .player-sidebar { border-left: none; border-top: 1px solid rgba(255,255,255,.07); max-height: 300px; }
  .player-controls { flex-direction: column; align-items: flex-start; gap: 10px; padding: 12px 16px; }
  .pc-right { width: 100%; justify-content: space-between; }
  .seasons-section { padding: 20px 16px; }
  .season-tabs-row { gap: 6px; }
  .season-tab { padding: 6px 12px; font-size: 12px; }
  .episode-card { padding: 10px; gap: 10px; }
  .ep-thumb { width: 80px; height: 52px; }
  .detail-body { padding: 24px 16px; }
  .info-card { padding: 16px; }
  .similar-sec { padding: 20px 16px; }
.site-footer { background:var(--surface); border-top:1px solid var(--border); padding:48px; display:grid; grid-template-columns:2fr 1fr 1fr 1fr 1fr; gap:40px; margin-top:32px; }
  .site-footer { grid-template-columns: 1fr 1fr; gap: 24px; padding: 32px 16px; }
  .footer { grid-template-columns: 1fr 1fr; gap: 24px; padding: 32px 16px; }
}
</style>
</head>
<body>

<!-- CURSOR -->
<div class="cursor-dot" id="cursorDot"></div>
<div class="cursor-ring" id="cursorRing"></div>
<div class="scroll-prog" id="scrollProg"></div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<!-- NAV -->
<nav id="nav">
  <a class="logo" href="#" onclick="navigate('home');return false">NE <span>Ä°ZLESEN</span></a>
  <ul class="nav-links">
    <li><a href="#" id="nav-home" class="active" onclick="navigate('home');return false">Ana Sayfa</a></li>
    <li><a href="#" id="nav-movies" onclick="navigate('movies');return false">Filmler</a></li>
    <li><a href="#" id="nav-series" onclick="navigate('series');return false">Diziler</a></li>
    <li><a href="#" id="nav-new" onclick="navigate('new');return false">Yeni Eklenenler</a></li>
    <li><a href="#" id="nav-calendar" onclick="navigate('calendar');return false">Takvim</a></li>
    <li><a href="#" id="nav-list" onclick="navigate('mylist');return false">Listelerim</a></li>
  </ul>
  <div class="nav-right">
    <div class="search-wrap">
      <div class="search-bar">
        <svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
        <input type="search" placeholder="Film, dizi, oyuncu ara..." id="searchInput" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" name="neizlesen-search" role="searchbox">
        <div class="search-dropdown" id="searchDrop">
          <div class="sug-header">SonuÃ§lar</div>
          <div id="sugList"><div style="padding:20px;text-align:center;color:var(--muted);font-size:13px">Aramak iÃ§in yazÄ±n...</div></div>
        </div>
      </div>
    </div>
    <button class="nav-icon-btn" onclick="toggleTheme()" id="themeBtn" title="Tema deÄŸiÅŸtir">ðŸŒ™</button>
    <div id="authBtns" style="display:flex;gap:10px">
      <button class="btn-ghost" onclick="openAuth('login')">GiriÅŸ Yap</button>
      <button class="btn-primary" onclick="openAuth('register')">Ãœye Ol</button>
    </div>
    <div class="user-chip" id="userChip" style="display:none">
      <div class="user-avatar" id="uAvatar" onclick="navigate('profile')" style="cursor:none">U</div>
      <button class="btn-ghost" onclick="doLogout()">Ã‡Ä±kÄ±ÅŸ</button>
    </div>
    <button class="hamburger-btn" id="hamburgerBtn" onclick="openMobileMenu()">
      <span></span><span></span><span></span>
    </button>
  </div>
</nav>

<!-- PAGES -->
<div class="page active" id="page-home"></div>
<div class="page" id="page-movies"></div>
<div class="page" id="page-series"></div>
<div class="page" id="page-new"></div>
<div class="page" id="page-mylist"></div>
<div class="page" id="page-browse"></div>
<div class="page" id="page-detail"></div>
<div class="page" id="page-search"></div>
<div class="page" id="page-profile"></div>
<div class="page" id="page-calendar"></div>
<div class="page" id="page-person"></div>
<div class="page" id="page-404"></div>
<div class="page" id="page-dmca"></div>

<!-- MOBILE OVERLAY + MENU -->
<div class="mobile-overlay" id="mobileOverlay" onclick="closeMobileMenu()"></div>
<div class="mobile-menu" id="mobileMenu">
  <div class="mm-head">
    <div class="mm-logo">NE <span>Ä°ZLESEN</span></div>
    <button class="mm-close" onclick="closeMobileMenu()">âœ•</button>
  </div>
  <div class="mm-user" id="mmUser"></div>
  <nav class="mm-nav">
    <a href="#" onclick="navigate('home');closeMobileMenu();return false">ðŸ  Ana Sayfa</a>
    <a href="#" onclick="navigate('movies');closeMobileMenu();return false">ðŸŽ¬ Filmler</a>
    <a href="#" onclick="navigate('series');closeMobileMenu();return false">ðŸ“º Diziler</a>
    <a href="#" onclick="navigate('new');closeMobileMenu();return false">âœ¨ Yeni Eklenenler</a>
    <a href="#" onclick="navigate('calendar');closeMobileMenu();return false">ðŸ“… Dizi Takvimi</a>
    <a href="#" onclick="navigate('mylist');closeMobileMenu();return false">â¤ï¸ Listelerim</a>
    <a href="#" onclick="navigate('profile');closeMobileMenu();return false" id="mm-profile-link">ðŸ‘¤ Profil</a>
  </nav>
  <div class="mm-theme">
    <span style="color:var(--muted);font-size:13px">Tema</span>
    <button class="theme-toggle-btn" onclick="toggleTheme()" id="mmThemeToggle">ðŸŒ™ KaranlÄ±k</button>
  </div>
</div>

<!-- TRAILER MODAL -->
<div class="modal-overlay" id="trailerModal">
  <div class="modal trailer-modal">
    <button class="modal-x" onclick="closeTrailer()" style="z-index:10">âœ•</button>
    <div class="trailer-titlebar" id="trailerTitleBar"></div>
    <div class="trailer-wrap">
      <iframe id="trailerFrame" class="trailer-iframe" src="" allowfullscreen allow="autoplay; fullscreen"></iframe>
    </div>
  </div>
</div>

<!-- AUTH MODAL -->
<div class="modal-overlay" id="authModal">
  <div class="modal auth-modal">
    <button class="modal-x" onclick="closeModal('authModal')">âœ•</button>
    <div class="am-head">
      <div class="am-logo">NE <span>Ä°ZLESEN</span></div>
      <p class="am-sub" id="amSub">HesabÄ±na giriÅŸ yap</p>
    </div>
    <div class="am-tabs">
      <button class="am-tab active" id="amTabLogin" onclick="switchAuth('login')">GiriÅŸ Yap</button>
      <button class="am-tab" id="amTabReg" onclick="switchAuth('register')">Ãœye Ol</button>
    </div>
    <div class="am-body">
      <div class="am-err" id="amErr"></div>
      <div id="amLogin">
        <div class="fg"><label>E-posta</label><input type="email" id="lEmail" name="email" placeholder="ornek@email.com" autocomplete="email"></div>
        <div class="fg"><label>Åžifre</label><input type="password" id="lPass" name="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="current-password" onkeydown="if(event.key==='Enter')doLogin()"></div>
        <button class="btn-auth" onclick="doLogin()">GÄ°RÄ°Åž YAP</button>
        <p class="am-link">HesabÄ±n yok mu? <a href="#" onclick="switchAuth('register');return false">Ãœye ol</a></p>
      </div>
      <div id="amReg" style="display:none">
        <div class="fg"><label>Ad Soyad</label><input type="text" id="rName" name="name" placeholder="AdÄ±nÄ±z SoyadÄ±nÄ±z" autocomplete="name"></div>
        <div class="fg"><label>E-posta</label><input type="email" id="rEmail" name="email" placeholder="ornek@email.com" autocomplete="email"></div>
        <div class="fg"><label>Åžifre</label><input type="password" id="rPass" name="new-password" placeholder="En az 6 karakter" autocomplete="new-password" onkeydown="if(event.key==='Enter')doRegister()"></div>
        <button class="btn-auth" onclick="doRegister()">KAYIT OL</button>
        <p class="am-link">HesabÄ±n var mÄ±? <a href="#" onclick="switchAuth('login');return false">GiriÅŸ yap</a></p>
      </div>
    </div>
  </div>
</div>

<script>
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// CONFIG
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const API_KEY = '4b19cfb150897a9071d51539b2ffc42f';
const BASE = 'https://api.themoviedb.org/3';
const IMG_W = 'https://image.tmdb.org/t/p/w342';
const IMG_M = 'https://image.tmdb.org/t/p/w780';
const IMG_L = 'https://image.tmdb.org/t/p/w1280';
const IMG_O = 'https://image.tmdb.org/t/p/original';

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// STATE
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let genres = {};
let currentPage = 'home';
let heroMovies = [];
let heroIdx = 0;
let heroTimer;
let currentUser = JSON.parse(localStorage.getItem('cm_user') || 'null');
let watchlist = JSON.parse(localStorage.getItem('cm_watchlist') || '[]');
let watchHistory = JSON.parse(localStorage.getItem('cm_history') || '[]');
let userRatings = JSON.parse(localStorage.getItem('cm_ratings') || '{}');
let userReviews = JSON.parse(localStorage.getItem('cm_reviews') || '{}');
let browseState = { type: 'movie', genreId: null, sortBy: 'popularity.desc', year: '', page: 1, title: '', sub: '' };
let currentDetail = null;
let isDark = localStorage.getItem('cm_theme') !== 'light';

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// INIT
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(async () => {
  // Apply saved theme
  if (!isDark) document.body.classList.add('light');
  updateThemeBtn();

  initCursor();
  initScroll();
  initSearch();
  initHistory();
  updateAuthUI();
  await loadGenres();

  // TarayÄ±cÄ± autocomplete'in arama kutusuna e-posta doldurmasÄ±nÄ± engelle
  const si = document.getElementById('searchInput');
  if (si) { si.value = ''; si.setAttribute('readonly', ''); setTimeout(() => si.removeAttribute('readonly'), 100); }

  // URL-based routing
  handleURL();
  window.addEventListener('popstate', handleURL);
})();

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// API HELPER
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function api(path, params = {}) {
  const p = new URLSearchParams({ api_key: API_KEY, language: 'tr-TR', ...params });
  const r = await fetch(`${BASE}${path}?${p}`);
  if (!r.ok) throw new Error('API error');
  return r.json();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// GENRES
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadGenres() {
  try {
    const [gm, gt] = await Promise.all([
      api('/genre/movie/list'),
      api('/genre/tv/list')
    ]);
    [...gm.genres, ...gt.genres].forEach(g => genres[g.id] = g.name);
  } catch(e) {}
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// URL ROUTING
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function handleURL() {
  const hash = location.hash.slice(1) || 'home';
  const [page, ...rest] = hash.split('/');
  const opts = {};
  if (rest[0]) opts.id = parseInt(rest[0]);
  if (rest[1]) opts.mediaType = rest[1];
  if (rest[2]) opts.query = decodeURIComponent(rest[2]);
  navigateInternal(page, opts);
}

window.navigate = function(page, opts = {}, pushState = true) {
  let hash = '#' + page;
  if (opts.id) hash += '/' + opts.id + (opts.mediaType ? '/' + opts.mediaType : '');
  if (opts.query) hash += '/' + encodeURIComponent(opts.query);
  if (pushState) {
    history.pushState({}, '', hash);
  }
  navigateInternal(page, opts);
};

function navigateInternal(page, opts = {}) {
  // Sayfadan ayrÄ±lÄ±rken player iframe'i durdur ve temizle
  const playerWrap = document.getElementById('playerWrap');
  if (playerWrap) {
    const iframe = playerWrap.querySelector('iframe');
    if (iframe) {
      iframe.src = '';          // ses/video durdur
      iframe.remove();          // DOM'dan kaldÄ±r
    }
  }
  // Trailer modal aÃ§Ä±ksa kapat
  const trailerFrame = document.getElementById('trailerFrame');
  if (trailerFrame) trailerFrame.src = '';
  const trailerModal = document.getElementById('trailerModal');
  if (trailerModal) trailerModal.style.display = 'none';

  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-links a').forEach(a => a.classList.remove('active'));
  currentPage = page;
  const navEl = document.getElementById('nav-' + page);
  if (navEl) navEl.classList.add('active');
  window.scrollTo({ top: 0, behavior: 'instant' });

  // Sayfa baÅŸlÄ±ÄŸÄ±nÄ± sÄ±fÄ±rla (detail sayfasÄ± kendi baÅŸlÄ±ÄŸÄ±nÄ± set eder)
  if (page !== 'detail') document.title = 'Ne Ä°zlesen â€” Film & Dizi Ä°zle';

  const el = document.getElementById('page-' + page);
  if (!el) { render404(); document.getElementById('page-404').classList.add('active'); return; }
  el.classList.add('active');

  switch(page) {
    case 'home':     renderHomePage(); break;
    case 'movies':   renderBrowsePage({ type:'movie', title:'TÃœM FÄ°LMLER', sub:'Binlerce filmden seÃ§in', genreId: opts.genreId||null, sortBy: opts.sortBy||'popularity.desc' }); break;
    case 'series':   renderBrowsePage({ type:'tv', title:'TÃœM DÄ°ZÄ°LER', sub:'PopÃ¼ler ve gÃ¼ncel diziler', genreId: opts.genreId||null, sortBy: opts.sortBy||'popularity.desc' }); break;
    case 'new':      renderBrowsePage({ type:'movie', title:'YENÄ° EKLENENLER', sub:'En son Ã§Ä±kan filmler', sortBy:'release_date.desc' }); break;
    case 'mylist':   renderMyList(); break;
    case 'browse':   renderBrowsePage(opts); break;
    case 'detail':   if (opts.id) renderDetailPage(opts.id, opts.mediaType||'movie'); else render404(); break;
    case 'search':   renderSearchPage(opts.query || ''); break;
    case 'profile':  renderProfilePage(); break;
    case 'calendar': renderCalendarPage(); break;
    case 'person':   if (opts.id) renderPersonPage(opts.id); else render404(); break;
    case 'dmca':     renderDmcaPage(); break;
    case '404':      render404(); break;
    default:         render404();
  }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// KÃœRATÃ–RLÃœ TÃœRKÄ°YE LÄ°STESÄ°
// AraÅŸtÄ±rmaya dayalÄ±: Netflix TR top 10, Google Trends TR, 2024-2025
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// TÃ¼rkiye'de son dÃ¶nem en Ã§ok aranan/izlenen YABANCI diziler (TMDB ID'leri)
const TR_HOT_SERIES = [
  { id: 93405,  label: 'ðŸ”¥ Åžu An GÃ¼ndemde' },  // Squid Game
  { id: 202555, label: 'ðŸ”¥ Åžu An GÃ¼ndemde' },  // Adolescence
  { id: 94997,  label: 'ðŸ”¥ Åžu An GÃ¼ndemde' },  // Wednesday
  { id: 136315, label: 'ðŸ”¥ Åžu An GÃ¼ndemde' },  // Fallout
  { id: 119051, label: 'ðŸ”¥ Åžu An GÃ¼ndemde' },  // The Last of Us
  { id: 84958,  label: 'ðŸ”¥ Åžu An GÃ¼ndemde' },  // Loki
  { id: 202673, label: 'ðŸ”¥ Åžu An GÃ¼ndemde' },  // The White Lotus S3
  { id: 37680,  label: 'ðŸ”¥ Åžu An GÃ¼ndemde' },  // Suits
  { id: 76479,  label: 'ðŸ”¥ Åžu An GÃ¼ndemde' },  // The Boys
  { id: 71912,  label: 'ðŸ”¥ Åžu An GÃ¼ndemde' },  // The Witcher
  { id: 85937,  label: 'ðŸ”¥ Åžu An GÃ¼ndemde' },  // Cobra Kai
  { id: 88396,  label: 'ðŸ”¥ Åžu An GÃ¼ndemde' },  // The Falcon & Winter Soldier
];

// TÃ¼rkiye'de sevilen kalÄ±cÄ± yabancÄ± diziler (Dexter, House gibi)
const TR_CLASSIC_SERIES = [
  { id: 1402,   label: 'ðŸ‘‘ Efsane' },  // The Walking Dead
  { id: 1418,   label: 'ðŸ‘‘ Efsane' },  // Big Bang Theory
  { id: 1396,   label: 'ðŸ‘‘ Efsane' },  // Breaking Bad
  { id: 1406,   label: 'ðŸ‘‘ Efsane' },  // Dexter
  { id: 1408,   label: 'ðŸ‘‘ Efsane' },  // House M.D.
  { id: 4614,   label: 'ðŸ‘‘ Efsane' },  // The Blacklist
  { id: 46648,  label: 'ðŸ‘‘ Efsane' },  // Peaky Blinders
  { id: 1920,   label: 'ðŸ‘‘ Efsane' },  // Prison Break
  { id: 2316,   label: 'ðŸ‘‘ Efsane' },  // The Office
  { id: 1421,   label: 'ðŸ‘‘ Efsane' },  // Modern Family
  { id: 60735,  label: 'ðŸ‘‘ Efsane' },  // The Flash
  { id: 62286,  label: 'ðŸ‘‘ Efsane' },  // Fear the Walking Dead
];

// TÃ¼rkiye'de 2024-2025'te en Ã§ok aranan filmler
const TR_HOT_MOVIES = [
  1022789, // Inside Out 2
  823464,  // Godzilla x Kong
  653346,  // Kingdom of the Planet of the Apes
  786892,  // Furiosa
  519182,  // Despicable Me 4
  748783,  // The Garfield Movie
  573435,  // Bad Boys: Ride or Die
  974453,  // Rebel Ridge
  1011985, // Kung Fu Panda 4
  558449,  // Gladiator II
  912649,  // Venom: The Last Dance
  945961,  // Alien: Romulus
];

async function renderHomePage() {
  const el = document.getElementById('page-home');
  el.innerHTML = `
    <div id="heroSection"><div style="height:100vh;display:flex;align-items:center;justify-content:center"><div class="spinner"></div></div></div>

    ${watchHistory.length ? `
    <div class="sec" style="padding-top:24px;padding-bottom:8px">
      <div class="sec-head">
        <div><div class="sec-title">KALDIÄžIN <span>YERDEN</span></div><div class="sec-sub">Son izlediklerin</div></div>
        <a class="see-all" href="#" onclick="navigate('profile');return false">TÃ¼mÃ¼ â†’</a>
      </div>
      <div class="h-scroll-wrap">
        <div class="h-scroll" id="continueRow">${watchHistory.slice(0,10).map(h => `
          <div class="film-card" onclick="navigate('detail',{id:${h.id},mediaType:'${h.mediaType}'})">
            <div class="fc-wrap">
              <img class="fc-img" src="${h.poster ? IMG_W+h.poster : ''}" alt="${esc(h.title)}" onerror="this.style.background='var(--card2)'">
              <div class="fc-badge">%${Math.round(h.progress||0)}</div>
              <div class="fc-overlay"><div class="fc-play"><svg width="18" height="18" viewBox="0 0 24 24" fill="#07090e"><polygon points="5,3 19,12 5,21"/></svg></div></div>
              <div style="position:absolute;bottom:0;left:0;right:0;height:3px;background:var(--border)"><div style="height:100%;width:${Math.round(h.progress||0)}%;background:var(--accent)"></div></div>
            </div>
            <div class="fc-info"><div class="fc-title">${esc(h.title)}</div><div class="fc-meta"><span>${h.mediaType==='tv'?'Dizi':'Film'}</span></div></div>
          </div>`).join('')}
        </div>
        <button class="scroll-btn left" onclick="scrollRowEl(this,-1)">&#8249;</button>
        <button class="scroll-btn right" onclick="scrollRowEl(this,1)">&#8250;</button>
      </div>
    </div>` : ''}

    <div class="sec" style="padding-top:${watchHistory.length?'8px':'32px'}">
      <div class="sec-head"><div><div class="sec-title">KATEGORÄ°LER</div></div></div>
      ${renderCategories()}
    </div>

    <!-- TÃœRKÄ°YE'NÄ°N GÃœNDEM DÄ°ZÄ°LERÄ° -->
    <div class="sec" style="padding-top:8px">
      <div class="sec-head">
        <div>
          <div class="sec-title">TÃœRKÄ°YE'NÄ°N <span>GÃœNDEM DÄ°ZÄ°LERÄ°</span></div>
          <div class="sec-sub">Åžu an en Ã§ok aranan ve izlenen yabancÄ± diziler</div>
        </div>
        <a class="see-all" href="#" onclick="navigate('series');return false">TÃ¼mÃ¼nÃ¼ GÃ¶r <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="m9 18 6-6-6-6"/></svg></a>
      </div>
      <div class="h-scroll-wrap">
        <div class="h-scroll" id="trHotSeries"></div>
        <button class="scroll-btn left" onclick="scrollRowEl(this,-1)">&#8249;</button>
        <button class="scroll-btn right" onclick="scrollRowEl(this,1)">&#8250;</button>
      </div>
    </div>

    <!-- TÃœRKÄ°YE'NÄ°N GÃœNDEM FÄ°LMLERÄ° -->
    <div class="sec" style="padding-top:8px">
      <div class="sec-head">
        <div>
          <div class="sec-title">Ã‡OK ARANAN <span>FÄ°LMLER</span></div>
          <div class="sec-sub">2024-2025 TÃ¼rkiye'nin en Ã§ok aradÄ±ÄŸÄ± yabancÄ± filmler</div>
        </div>
        <a class="see-all" href="#" onclick="navigate('movies');return false">TÃ¼mÃ¼nÃ¼ GÃ¶r <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="m9 18 6-6-6-6"/></svg></a>
      </div>
      <div class="h-scroll-wrap">
        <div class="h-scroll" id="trHotMovies"></div>
        <button class="scroll-btn left" onclick="scrollRowEl(this,-1)">&#8249;</button>
        <button class="scroll-btn right" onclick="scrollRowEl(this,1)">&#8250;</button>
      </div>
    </div>

    <!-- TMDB TRENDING (gerÃ§ek zamanlÄ±) -->
    <div class="sec" style="padding-top:8px">
      <div class="sec-head">
        <div>
          <div class="sec-title">BU HAFTA <span>TREND</span></div>
          <div class="sec-sub">DÃ¼nya genelinde bu hafta en Ã§ok izlenenler</div>
        </div>
        <a class="see-all" href="#" onclick="navigate('movies');return false">TÃ¼mÃ¼nÃ¼ GÃ¶r â†’</a>
      </div>
      <div class="h-scroll-wrap">
        <div class="h-scroll" id="weeklyTrending"></div>
        <button class="scroll-btn left" onclick="scrollRowEl(this,-1)">&#8249;</button>
        <button class="scroll-btn right" onclick="scrollRowEl(this,1)">&#8250;</button>
      </div>
    </div>

    <!-- EFSANE DÄ°ZÄ°LER -->
    <div class="sec" style="padding-top:8px">
      <div class="sec-head">
        <div>
          <div class="sec-title">EFSANE <span>DÄ°ZÄ°LER</span></div>
          <div class="sec-sub">Dexter, House, Breaking Bad... Asla eski olmayan yapÄ±mlar</div>
        </div>
        <a class="see-all" href="#" onclick="navigate('series',{sortBy:'vote_average.desc'});return false">TÃ¼mÃ¼nÃ¼ GÃ¶r â†’</a>
      </div>
      <div class="h-scroll-wrap">
        <div class="h-scroll" id="classicSeries"></div>
        <button class="scroll-btn left" onclick="scrollRowEl(this,-1)">&#8249;</button>
        <button class="scroll-btn right" onclick="scrollRowEl(this,1)">&#8250;</button>
      </div>
    </div>

    <!-- FEATURED BANNER -->
    <div class="featured-banner" id="featBanner" onclick="navigate('browse',{type:'tv',genreId:80,title:'SUÃ‡ & GERÄ°LÄ°M DÄ°ZÄ°LERÄ°',sub:'En iyi suÃ§ ve gerilim dizileri',sortBy:'vote_average.desc'})">
      <div style="padding:40px 44px;background:linear-gradient(135deg,#0a0a1a,#1a1a40,#0d1b3e);width:100%;min-height:220px;display:flex;align-items:center;position:relative;overflow:hidden">
        <div style="position:absolute;inset:0;background:radial-gradient(ellipse at 80% 50%,rgba(61,155,255,0.15),transparent 60%)"></div>
        <div style="position:relative;z-index:2">
          <div class="fb-label">ðŸ“º Ã–zel Kategori</div>
          <div class="fb-title">SUÃ‡ & GERÄ°LÄ°M DÄ°ZÄ°LERÄ°</div>
          <div class="fb-sub">Breaking Bad'den Peaky Blinders'a, en iyi suÃ§ dizilerini keÅŸfet</div>
          <button class="btn-sm" style="margin-top:16px">KEÅžFET â†’</button>
        </div>
      </div>
    </div>

    <!-- NETFLIX TR TOP â€” gerÃ§ek zamanlÄ± popular -->
    <div class="sec" style="margin-top:16px">
      <div class="sec-head">
        <div>
          <div class="sec-title">POPÃœLER <span>DÄ°ZÄ°LER</span></div>
          <div class="sec-sub">Platform genelinde ÅŸu an en popÃ¼ler yabancÄ± diziler</div>
        </div>
        <a class="see-all" href="#" onclick="navigate('series');return false">TÃ¼mÃ¼nÃ¼ GÃ¶r â†’</a>
      </div>
      <div class="h-scroll-wrap">
        <div class="h-scroll" id="popularSeriesLive"></div>
        <button class="scroll-btn left" onclick="scrollRowEl(this,-1)">&#8249;</button>
        <button class="scroll-btn right" onclick="scrollRowEl(this,1)">&#8250;</button>
      </div>
    </div>

    <!-- YENÄ° VÄ°ZYON FÄ°LMLER -->
    <div class="sec">
      <div class="sec-head">
        <div>
          <div class="sec-title">YENÄ° <span>VÄ°ZYON</span></div>
          <div class="sec-sub">Son aylarda vizyona giren yabancÄ± filmler</div>
        </div>
        <a class="see-all" href="#" onclick="navigate('new');return false">TÃ¼mÃ¼nÃ¼ GÃ¶r â†’</a>
      </div>
      <div class="h-scroll-wrap">
        <div class="h-scroll" id="newRelease"></div>
        <button class="scroll-btn left" onclick="scrollRowEl(this,-1)">&#8249;</button>
        <button class="scroll-btn right" onclick="scrollRowEl(this,1)">&#8250;</button>
      </div>
    </div>

    <footer class="site-footer">
      <div>
        <div style="font-family:'Bebas Neue',sans-serif;font-size:28px;letter-spacing:3px;color:var(--accent);margin-bottom:14px">NE <span style="color:#fff">Ä°ZLESEN</span></div>
        <p style="font-size:14px;color:var(--muted);line-height:1.7">En iyi yabancÄ± film ve dizileri yÃ¼ksek kalitede izleyin.</p>
      </div>
      ${['KeÅŸfet','Hesap','Destek'].map((t,i) => `<div><h4 style="font-size:11px;font-weight:600;letter-spacing:2px;color:var(--text);text-transform:uppercase;margin-bottom:16px">${t}</h4><ul style="list-style:none">${[['Filmler','Diziler','Kategoriler','Yeni Vizyonlar'],['Profil','Listelerim','GeÃ§miÅŸ','Ayarlar'],['YardÄ±m','Ä°letiÅŸim','Gizlilik','Åžartlar']][i].map(x=>`<li style="margin-bottom:10px"><a href="#" style="color:var(--muted);text-decoration:none;font-size:14px" onmouseover="this.style.color='var(--accent)'" onmouseout="this.style.color='var(--muted)'">${x}</a></li>`).join('')}</ul></div>`).join('')}
      <div>
        <h4 style="font-size:11px;font-weight:600;letter-spacing:2px;color:var(--text);text-transform:uppercase;margin-bottom:16px">Yasal</h4>
        <ul style="list-style:none">
          <li style="margin-bottom:10px"><a href="#" onclick="navigate('dmca');return false" style="color:var(--muted);text-decoration:none;font-size:14px" onmouseover="this.style.color='var(--accent)'" onmouseout="this.style.color='var(--muted)'">DMCA</a></li>
          <li style="margin-bottom:10px"><a href="#" style="color:var(--muted);text-decoration:none;font-size:14px" onmouseover="this.style.color='var(--accent)'" onmouseout="this.style.color='var(--muted)'">Gizlilik PolitikasÄ±</a></li>
          <li style="margin-bottom:10px"><a href="#" style="color:var(--muted);text-decoration:none;font-size:14px" onmouseover="this.style.color='var(--accent)'" onmouseout="this.style.color='var(--muted)'">KullanÄ±m ÅžartlarÄ±</a></li>
          <li style="margin-bottom:10px"><a href="#" style="color:var(--muted);text-decoration:none;font-size:14px" onmouseover="this.style.color='var(--accent)'" onmouseout="this.style.color='var(--muted)'">Ã‡erez PolitikasÄ±</a></li>
        </ul>
      </div>
    </footer>
    <div style="background:var(--surface);border-top:1px solid var(--border);padding:16px 48px;display:flex;justify-content:space-between;font-size:12px;color:var(--muted)">
      <span>Â© 2025 Ne Ä°zlesen. TÃ¼m haklarÄ± saklÄ±dÄ±r.</span><span>TÃ¼rkiye ðŸ‡¹ðŸ‡·</span>
    </div>
  `;

  // Hero â€” TR gÃ¼ndem dizilerinden birini seÃ§
  loadHeroFromCurated();

  // KÃ¼ratÃ¶rlÃ¼ listeler
  loadCuratedSeries('trHotSeries', TR_HOT_SERIES);
  loadCuratedMovies('trHotMovies', TR_HOT_MOVIES);
  loadCuratedSeries('classicSeries', TR_CLASSIC_SERIES);

  // TMDB gerÃ§ek zamanlÄ±
  loadSection('weeklyTrending', '/trending/all/week', {}, 'auto');
  loadSection('popularSeriesLive', '/tv/popular', { with_origin_country:'US|GB|KR|JP' }, 'tv');
  loadSection('newRelease', '/movie/now_playing', {}, 'movie');
}

// KÃ¼ratÃ¶rlÃ¼ dizi listesini yÃ¼kle (ID listesinden)
async function loadCuratedSeries(containerId, list) {
  const el = document.getElementById(containerId);
  if (!el) return;
  el.innerHTML = Array(list.length).fill(`<div class="skeleton" style="width:170px;flex-shrink:0;aspect-ratio:2/3;border-radius:12px"></div>`).join('');
  const results = await Promise.allSettled(
    list.map(item => api(`/tv/${item.id || item}`, {}).then(d => ({ ...d, _label: item.label })))
  );
  el.innerHTML = results
    .filter(r => r.status === 'fulfilled' && r.value.poster_path)
    .map(r => {
      const m = r.value;
      const title = m.name || m.original_name || '';
      const year = (m.first_air_date || '').slice(0,4);
      const rating = m.vote_average?.toFixed(1) || 'â€”';
      const isNew = year >= '2023';
      return `
        <div class="film-card" onclick="navigate('detail',{id:${m.id},mediaType:'tv'})">
          <div class="fc-wrap">
            <img class="fc-img" src="${IMG_W}${m.poster_path}" alt="${esc(title)}" loading="lazy">
            <div class="fc-badge ${isNew?'fc-new':''}">${isNew?'YENÄ°':'HD'}</div>
            <div class="fc-rating">â˜… ${rating}</div>
            <div class="fc-overlay"><div class="fc-play"><svg width="18" height="18" viewBox="0 0 24 24" fill="#07090e"><polygon points="5,3 19,12 5,21"/></svg></div></div>
          </div>
          <div class="fc-info">
            <div class="fc-title">${esc(title)}</div>
            <div class="fc-meta"><span>${year}</span><span>Â·</span><span>Dizi</span></div>
          </div>
        </div>`;
    }).join('');
}

// KÃ¼ratÃ¶rlÃ¼ film listesini yÃ¼kle
async function loadCuratedMovies(containerId, idList) {
  const el = document.getElementById(containerId);
  if (!el) return;
  el.innerHTML = Array(idList.length).fill(`<div class="skeleton" style="width:170px;flex-shrink:0;aspect-ratio:2/3;border-radius:12px"></div>`).join('');
  const results = await Promise.allSettled(idList.map(id => api(`/movie/${id}`)));
  el.innerHTML = results
    .filter(r => r.status === 'fulfilled' && r.value.poster_path)
    .map(r => filmCardHtml(r.value, 'movie'))
    .join('');
}

// Hero: kÃ¼ratÃ¶rlÃ¼ listeden rastgele bir dizi/film
async function loadHeroFromCurated() {
  try {
    // Mix: son dÃ¶nem popÃ¼ler film + dizi
    const [movies, series] = await Promise.all([
      api('/trending/all/week', { page: 1 }),
      api('/tv/popular', {})
    ]);

    // Yerli filtre: TÃ¼rk yapÄ±mlarÄ±nÄ± Ã§Ä±kar
    const filtered = [
      ...movies.results.filter(m => m.backdrop_path && m.poster_path && m.original_language !== 'tr'),
      ...series.results.filter(s => s.backdrop_path && s.poster_path && s.original_language !== 'tr'),
    ].slice(0, 10);

    heroMovies = filtered;
    renderHero(0);
    clearInterval(heroTimer);
    heroTimer = setInterval(() => {
      heroIdx = (heroIdx + 1) % heroMovies.length;
      renderHero(heroIdx);
    }, 7000);
  } catch(e) {
    document.getElementById('heroSection').innerHTML = '<div style="height:100vh"></div>';
  }
}

function renderCategories() {
  const cats = [
    { emoji:'ðŸŽ¬', label:'Aksiyon', id:28, type:'movie', bg:'linear-gradient(135deg,#1a0808,#6b1515)' },
    { emoji:'ðŸ˜‚', label:'Komedi', id:35, type:'movie', bg:'linear-gradient(135deg,#1a180a,#6b5a15)' },
    { emoji:'ðŸ’€', label:'Korku', id:27, type:'movie', bg:'linear-gradient(135deg,#0a0a1a,#151530)' },
    { emoji:'ðŸš€', label:'Sci-Fi', id:878, type:'movie', bg:'linear-gradient(135deg,#0a1020,#103060)' },
    { emoji:'ðŸ’‘', label:'Romantik', id:10749, type:'movie', bg:'linear-gradient(135deg,#1a0a15,#6b1545)' },
    { emoji:'ðŸ”', label:'SuÃ§', id:80, type:'movie', bg:'linear-gradient(135deg,#141414,#303030)' },
    { emoji:'ðŸ§ ', label:'Gerilim', id:53, type:'movie', bg:'linear-gradient(135deg,#0f0f1a,#1a1a40)' },
    { emoji:'ðŸ²', label:'Fantezi', id:14, type:'movie', bg:'linear-gradient(135deg,#0a1a0a,#1a4a1a)' },
    { emoji:'ðŸ˜­', label:'Dram', id:18, type:'movie', bg:'linear-gradient(135deg,#1a0f0a,#4a2a10)' },
    { emoji:'ðŸŽ­', label:'Animasyon', id:16, type:'movie', bg:'linear-gradient(135deg,#0a1520,#154060)' },
    { emoji:'ðŸ“º', label:'Diziler', id:18, type:'tv', bg:'linear-gradient(135deg,#100a20,#301560)' },
    { emoji:'ðŸŒ', label:'Belgesel', id:99, type:'movie', bg:'linear-gradient(135deg,#0a1a10,#1a4a20)' },
  ];
  return `<div class="cat-strip">${cats.map(c => `
    <div class="cat-btn" onclick="navigate('browse',{type:'${c.type}',genreId:${c.id},title:'${c.label.toUpperCase()}',sub:'${c.label} kategorisindeki iÃ§erikler',sortBy:'popularity.desc'})">
      <div class="cat-icon" style="background:${c.bg}">${c.emoji}</div>
      <span class="cat-lbl">${c.label}</span>
    </div>`).join('')}</div>`;
}

async function loadHero() {
  try {
    const d = await api('/movie/popular', { page: 1 });
    heroMovies = d.results.filter(m => m.backdrop_path && m.poster_path).slice(0, 8);
    renderHero(0);
    clearInterval(heroTimer);
    heroTimer = setInterval(() => {
      heroIdx = (heroIdx + 1) % heroMovies.length;
      renderHero(heroIdx);
    }, 7000);
  } catch(e) {
    document.getElementById('heroSection').innerHTML = '<div style="height:100vh"></div>';
  }
}

function renderHero(idx) {
  const m = heroMovies[idx];
  if (!m) return;
  const r = m.vote_average?.toFixed(1) || 'â€”';
  const yr = (m.release_date || m.first_air_date || '').slice(0,4);
  const title = m.title || m.name || '';
  const mediaType = m.title ? 'movie' : 'tv';
  const gs = (m.genre_ids || []).slice(0,3).map(id => genres[id]).filter(Boolean);

  document.getElementById('heroSection').innerHTML = `
    <div class="hero">
      <div class="hero-bg">
        <img src="${IMG_O}${m.backdrop_path}" alt="" style="opacity:1">
      </div>
      <div class="hero-grad"></div>
      <div class="hero-content">
        <div class="hero-badge">${mediaType === 'tv' ? 'ðŸ“º Dizi' : 'ðŸŽ¬ Film'} Â· ${yr}</div>
        <h1 class="hero-title">${esc(title).toUpperCase()}</h1>
        <div class="hero-meta">
          <span class="hm rating">â˜… ${r}</span>
          <span class="dot"></span>
          <span class="hm">${yr}</span>
          <span class="dot"></span>
          <span class="hm">HD Â· 4K</span>
        </div>
        <div class="hero-genres">${gs.map(g=>`<span class="h-pill">${g}</span>`).join('')}</div>
        <p class="hero-desc">${esc(m.overview || 'AÃ§Ä±klama bulunamadÄ±.')}</p>
        <div class="hero-btns">
          <button class="btn-play" onclick="navigate('detail',{id:${m.id},mediaType:'${mediaType}'})">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="#07090e"><polygon points="5,3 19,12 5,21"/></svg>
            Ä°ZLE
          </button>
          <button class="btn-detail" onclick="navigate('detail',{id:${m.id},mediaType:'${mediaType}'})">
            <svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
            Detaylar
          </button>
        </div>
      </div>
      <div class="hero-nav">
        <button class="hero-prev" onclick="heroGo(-1)">&#8249;</button>
        ${heroMovies.map((_,i)=>`<div class="h-dot ${i===idx?'active':''}" onclick="heroGo2(${i})"></div>`).join('')}
        <button class="hero-next" onclick="heroGo(1)">&#8250;</button>
      </div>
    </div>
  `;
}

window.heroGo = function(dir) {
  clearInterval(heroTimer);
  heroIdx = (heroIdx + dir + heroMovies.length) % heroMovies.length;
  renderHero(heroIdx);
  heroTimer = setInterval(() => { heroIdx = (heroIdx+1)%heroMovies.length; renderHero(heroIdx); }, 7000);
};
window.heroGo2 = function(i) { clearInterval(heroTimer); heroIdx = i; renderHero(i); heroTimer = setInterval(()=>{heroIdx=(heroIdx+1)%heroMovies.length;renderHero(heroIdx);},7000); };

async function loadMovieGenreTabs() {
  const tabsEl = document.getElementById('movieGenreTabs');
  const genres_list = [
    { id:null, label:'TÃ¼mÃ¼' },
    { id:28, label:'Aksiyon' }, { id:35, label:'Komedi' }, { id:18, label:'Dram' },
    { id:27, label:'Korku' }, { id:878, label:'Bilim Kurgu' }, { id:16, label:'Animasyon' },
    { id:80, label:'SuÃ§' }, { id:53, label:'Gerilim' }, { id:14, label:'Fantezi' },
    { id:10749, label:'Romantik' }, { id:99, label:'Belgesel' }, { id:12, label:'Macera' }
  ];
  tabsEl.innerHTML = genres_list.map((g,i) =>
    `<button class="tab-btn ${i===0?'active':''}" onclick="changeMovieGenre(this,${g.id})">${g.label}</button>`
  ).join('');
  loadSection('popularMovies', '/discover/movie', { sort_by:'popularity.desc' }, 'movie');
}

window.changeMovieGenre = async function(el, genreId) {
  el.closest('.tabs').querySelectorAll('.tab-btn').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
  const params = { sort_by:'popularity.desc' };
  if (genreId) params.with_genres = genreId;
  loadSection('popularMovies', '/discover/movie', params, 'movie');
};

async function loadSeriesTabs() {
  const tabsEl = document.getElementById('seriesTabs');
  const tvGenres = [
    { id:null, label:'TÃ¼mÃ¼' },
    { id:18, label:'Dram' }, { id:10765, label:'Fantezi' }, { id:80, label:'SuÃ§' },
    { id:35, label:'Komedi' }, { id:10759, label:'Aksiyon' }, { id:9648, label:'Gizem' }, { id:10768, label:'SavaÅŸ' }
  ];
  tabsEl.innerHTML = tvGenres.map((g,i) =>
    `<button class="tab-btn ${i===0?'active':''}" onclick="changeTvGenre(this,${g.id})">${g.label}</button>`
  ).join('');
  loadSection('trendSeries', '/tv/popular', {}, 'tv');
}

window.changeTvGenre = async function(el, genreId) {
  el.closest('.tabs').querySelectorAll('.tab-btn').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
  const params = { sort_by:'popularity.desc' };
  if (genreId) params.with_genres = genreId;
  loadSection('trendSeries', '/discover/tv', params, 'tv');
};

async function loadSection(containerId, path, params, mediaType, page=1) {
  const el = document.getElementById(containerId);
  if (!el) return;
  el.innerHTML = Array(10).fill(`<div class="skeleton" style="width:170px;aspect-ratio:2/3;flex-shrink:0;border-radius:12px"></div>`).join('');
  try {
    const d = await api(path, { ...params, page });
    // 'auto' modunda TMDB'nin media_type alanÄ±nÄ± kullan (trending/all gibi karma endpoint'ler iÃ§in)
    el.innerHTML = d.results
      .filter(m => m.poster_path)
      .slice(0, 20)
      .map(m => {
        const mt = mediaType === 'auto' ? (m.media_type || (m.title ? 'movie' : 'tv')) : (mediaType || (m.title ? 'movie' : 'tv'));
        return filmCardHtml(m, mt);
      }).join('');
  } catch(e) {
    el.innerHTML = '<p style="color:var(--muted);padding:20px;font-size:14px">YÃ¼klenirken hata oluÅŸtu.</p>';
  }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// BROWSE PAGE
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function renderBrowsePage(opts) {
  browseState = { type: opts.type || 'movie', genreId: opts.genreId || null, sortBy: opts.sortBy || 'popularity.desc', year: opts.year || '', page: 1, title: opts.title || 'Ä°Ã‡ERÄ°KLER', sub: opts.sub || '' };
  const pageId = opts.type === 'tv' ? 'page-series' : (opts.genreId || opts.sortBy !== 'popularity.desc' ? 'page-browse' : 'page-movies');

  let el = document.getElementById(currentPage === 'movies' ? 'page-movies' : currentPage === 'series' ? 'page-series' : currentPage === 'new' ? 'page-new' : 'page-browse');
  if (!el) el = document.getElementById('page-browse');

  const yearOpts = ['', '2025','2024','2023','2022','2021','2020','2019','2018','2015','2010','2005','2000','1990','1980'];
  const sortOpts = [
    { v:'popularity.desc', l:'En PopÃ¼ler' }, { v:'vote_average.desc', l:'En YÃ¼ksek Puan' },
    { v:'release_date.desc', l:'En Yeni' }, { v:'release_date.asc', l:'En Eski' },
    { v:'revenue.desc', l:'En Ã‡ok HasÄ±lat' }
  ];
  const movieGenres = [{id:'',n:'TÃ¼m Kategoriler'},{id:28,n:'Aksiyon'},{id:35,n:'Komedi'},{id:18,n:'Dram'},{id:27,n:'Korku'},{id:878,n:'Bilim Kurgu'},{id:16,n:'Animasyon'},{id:80,n:'SuÃ§'},{id:53,n:'Gerilim'},{id:14,n:'Fantezi'},{id:10749,n:'Romantik'},{id:99,n:'Belgesel'},{id:12,n:'Macera'},{id:10402,n:'MÃ¼zik'}];
  const tvGenres = [{id:'',n:'TÃ¼m Kategoriler'},{id:18,n:'Dram'},{id:10765,n:'Fantezi'},{id:80,n:'SuÃ§'},{id:35,n:'Komedi'},{id:10759,n:'Aksiyon'},{id:9648,n:'Gizem'},{id:10768,n:'SavaÅŸ'},{id:10767,n:'Talk Show'}];
  const gList = browseState.type === 'tv' ? tvGenres : movieGenres;

  el.innerHTML = `
    <div class="browse-header">
      <div class="browse-title">${browseState.title}</div>
      <div class="browse-sub">${browseState.sub}</div>
    </div>
    <div class="browse-filters">
      <select class="filter-select" id="bGenre" onchange="browseFilter()">
        ${gList.map(g=>`<option value="${g.id}" ${browseState.genreId==g.id?'selected':''}>${g.n}</option>`).join('')}
      </select>
      <select class="filter-select" id="bSort" onchange="browseFilter()">
        ${sortOpts.map(s=>`<option value="${s.v}" ${browseState.sortBy===s.v?'selected':''}>${s.l}</option>`).join('')}
      </select>
      <select class="filter-select" id="bYear" onchange="browseFilter()">
        <option value="">TÃ¼m YÄ±llar</option>
        ${yearOpts.slice(1).map(y=>`<option value="${y}" ${browseState.year===y?'selected':''}>${y}</option>`).join('')}
      </select>
    </div>
    <div class="browse-content">
      <div class="result-count" id="bCount"></div>
      <div class="film-grid" id="browseGrid"></div>
      <div class="load-more-wrap" id="loadMoreWrap" style="display:none">
        <button class="btn-load-more" onclick="browseLoadMore()">Daha Fazla YÃ¼kle</button>
      </div>
    </div>
  `;
  browseLoad(1, true);
}

window.browseFilter = function() {
  browseState.genreId = document.getElementById('bGenre').value || null;
  browseState.sortBy = document.getElementById('bSort').value;
  browseState.year = document.getElementById('bYear').value;
  browseState.page = 1;
  browseLoad(1, true);
};

async function browseLoad(page, reset) {
  const grid = document.getElementById('browseGrid');
  const countEl = document.getElementById('bCount');
  if (!grid) return;
  if (reset) grid.innerHTML = Array(12).fill(`<div class="skeleton" style="aspect-ratio:2/3;border-radius:12px"></div>`).join('');
  try {
    const path = browseState.type === 'tv' ? '/discover/tv' : '/discover/movie';
    const params = {
      sort_by: browseState.sortBy, page, 'vote_count.gte': 50,
      without_original_language: 'tr'  // Yerli yapÄ±mlarÄ± gizle
    };
    if (browseState.genreId) params.with_genres = browseState.genreId;
    if (browseState.year) {
      if (browseState.type === 'tv') { params['first_air_date.gte'] = browseState.year+'-01-01'; params['first_air_date.lte'] = browseState.year+'-12-31'; }
      else { params['primary_release_date.gte'] = browseState.year+'-01-01'; params['primary_release_date.lte'] = browseState.year+'-12-31'; }
    }
    const d = await api(path, params);
    if (reset) grid.innerHTML = '';
    grid.innerHTML += d.results.map(m => filmCardHtml(m, browseState.type)).join('');
    if (countEl) countEl.innerHTML = `<strong>${d.total_results?.toLocaleString() || '...'}</strong> iÃ§erik bulundu`;
    const lmw = document.getElementById('loadMoreWrap');
    if (lmw) lmw.style.display = d.page < d.total_pages ? 'block' : 'none';
    browseState.page = page;
  } catch(e) {
    if (reset && grid) grid.innerHTML = '<p style="color:var(--muted);padding:40px;font-size:14px;grid-column:1/-1">YÃ¼klenirken hata oluÅŸtu.</p>';
  }
}

window.browseLoadMore = function() { browseLoad(browseState.page + 1, false); };

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// DETAIL PAGE
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function renderDetailPage(id, mediaType) {
  const el = document.getElementById('page-detail');
  el.innerHTML = '<div class="spinner" style="margin-top:200px"></div>';
  try {
    const [detail, credits, similar, videos] = await Promise.all([
      api(`/${mediaType}/${id}`, { append_to_response: 'keywords' }),
      api(`/${mediaType}/${id}/credits`),
      api(`/${mediaType}/${id}/similar`, { page: 1 }),
      api(`/${mediaType}/${id}/videos`)
    ]);
    currentDetail = { id, mediaType, detail };

    const title = detail.title || detail.name || '';
    const rating = detail.vote_average?.toFixed(1) || 'â€”';
    const year = (detail.release_date || detail.first_air_date || '').slice(0, 4);
    const runtime = detail.runtime
      ? `${Math.floor(detail.runtime / 60)}s ${detail.runtime % 60}dk`
      : (detail.episode_run_time?.[0] ? `${detail.episode_run_time[0]}dk/bÃ¶lÃ¼m` : '');
    const gs = detail.genres || [];
    const cast = (credits.cast || []).slice(0, 10);
    // YÃ¶netmen/yaratÄ±cÄ±
    const directors = (credits.crew || []).filter(c => c.job === 'Director').map(c => c.name);
    const director = directors.length ? directors.join(', ') : '';
    const simItems = (similar.results || []).filter(m => m.poster_path).slice(0, 12);
    const trailerKey = (videos.results || []).find(v => v.type === 'Trailer' && v.site === 'YouTube')?.key;
    const inList = watchlist.some(w => w.id === id && w.mediaType === mediaType);
    const typeLabel = mediaType === 'tv' ? 'DÄ°ZÄ°' : 'FÄ°LM';

    // Dinamik sayfa baÅŸlÄ±ÄŸÄ± ve OG etiketleri
    document.title = `${title} â€” Ne Ä°zlesen`;
    document.querySelector('meta[property="og:title"]')?.setAttribute('content', `${title} â€” Ne Ä°zlesen`);
    document.querySelector('meta[property="og:description"]')?.setAttribute('content', detail.overview?.slice(0,150) || '');
    if (detail.poster_path) document.querySelector('meta[property="og:image"]')?.setAttribute('content', IMG_W + detail.poster_path);
    document.querySelector('meta[name="twitter:title"]')?.setAttribute('content', `${title} â€” Ne Ä°zlesen`);
    document.querySelector('meta[name="description"]')?.setAttribute('content', detail.overview?.slice(0,150) || '');

    // Seasons â€” only for TV
    const seasons = mediaType === 'tv'
      ? (detail.seasons || []).filter(s => s.season_number > 0)
      : [];

    // Saved progress for this content
    const progressKey = `cm_progress_${mediaType}_${id}`;
    const savedProgress = JSON.parse(localStorage.getItem(progressKey) || 'null');
    const savedSeconds = savedProgress?.timestamp || 0;
    const progressPct = savedProgress?.progress || 0;
    const firstSeason = seasons[0]?.season_number || 1;
    const firstEp = 1;

    el.innerHTML = `
      <!-- PLAYER + SIDEBAR LAYOUT -->
      <div class="player-layout">

        <!-- SOL: Player -->
        <div class="player-main">
          <div class="progress-bar-wrap"><div class="progress-bar-fill" id="progressBarFill" style="width:${progressPct}%"></div></div>
          <div class="player-wrap" id="playerWrap">
            <div class="player-splash" id="playerSplash">
              <img class="player-splash-bg" src="${detail.backdrop_path ? IMG_L + detail.backdrop_path : ''}" alt="" onerror="this.style.display='none'">
              <div class="player-splash-content">
                <button class="splash-play-btn" onclick="startPlayer(${id},'${mediaType}',${firstSeason},${firstEp},${savedSeconds})">
                  <svg width="32" height="32" viewBox="0 0 24 24" fill="#07090e"><polygon points="5,3 19,12 5,21"/></svg>
                </button>
                <div class="splash-title">${esc(title).toUpperCase()}</div>
                <div class="splash-meta">${year}${runtime ? ' Â· ' + runtime : ''} Â· â˜… ${rating}</div>
                ${savedSeconds > 0 ? `<div class="splash-ep-label">â–¶ KaldÄ±ÄŸÄ±n yerden devam et (${formatTime(savedSeconds)})</div>` : ''}
                ${mediaType === 'tv' && seasons.length ? `<div class="splash-ep-label" id="splashEpLabel">S${String(firstSeason).padStart(2,'0')} E${String(firstEp).padStart(2,'0')}</div>` : ''}
              </div>
            </div>
          </div>
          <div class="player-controls">
            <div class="pc-left">
              <div class="pc-title" id="pcTitle">${esc(title)}</div>
              <div class="pc-meta" id="pcMeta">${year}${runtime ? ' Â· ' + runtime : ''} Â· â˜… ${rating}</div>
            </div>
            <div class="pc-right">
              ${savedSeconds > 0 ? `<span class="pc-progress-text" id="pcProgress">%${Math.round(progressPct)} izlendi</span>` : '<span class="pc-progress-text" id="pcProgress"></span>'}
              <button class="btn-sm" onclick="startPlayer(${id},'${mediaType}',${firstSeason},${firstEp},${savedSeconds})">
                <svg width="13" height="13" viewBox="0 0 24 24" fill="currentColor"><polygon points="5,3 19,12 5,21"/></svg>
                OYNAT
              </button>
            </div>
          </div>
        </div>

        <!-- SAÄž: Sidebar -->
        <div class="player-sidebar" id="playerSidebar">
          ${mediaType === 'tv' && seasons.length ? `
            <!-- BÃ¶lÃ¼m Listesi -->
            <div class="ps-header">
              <div class="ps-title">BÃ–LÃœMLER</div>
              <select class="ps-season-select" id="psSidebarSeasonSelect" onchange="loadSidebarSeason(${id}, this.value)">
                ${seasons.map(s => `<option value="${s.season_number}">Sezon ${s.season_number}</option>`).join('')}
              </select>
            </div>
            <div class="ps-ep-list" id="psSidebarEpList">
              <div class="spinner" style="margin:40px auto;width:24px;height:24px"></div>
            </div>
          ` : `
            <!-- Benzer Ä°Ã§erikler (film) -->
            <div class="ps-header">
              <div class="ps-title">BENZER Ä°Ã‡ERÄ°KLER</div>
            </div>
            <div class="ps-sim-list" id="psSidebarSimList">
              ${simItems.slice(0, 8).map(m => `
                <div class="ps-sim-item" onclick="navigate('detail',{id:${m.id},mediaType:'${mediaType}'})">
                  <img class="ps-sim-img" src="${IMG_W}${m.poster_path}" alt="${esc(m.title||m.name||'')}" loading="lazy">
                  <div class="ps-sim-info">
                    <div class="ps-sim-title">${esc(m.title||m.name||'')}</div>
                    <div class="ps-sim-meta">â˜… ${m.vote_average?.toFixed(1)||'â€”'} Â· ${(m.release_date||m.first_air_date||'').slice(0,4)}</div>
                  </div>
                </div>`).join('')}
            </div>
          `}
        </div>
      </div>`
    +
    `
      <!-- DETAIL HERO -->
      <div class="detail-hero">
        <div class="dh-bg"><img src="${detail.backdrop_path ? IMG_L + detail.backdrop_path : ''}" alt="" onerror="this.style.display='none'"></div>
        <div class="dh-grad"></div>
        <div class="dh-content">
          <div class="dh-poster">
            ${detail.poster_path
              ? `<img src="${IMG_W}${detail.poster_path}" alt="${esc(title)}">`
              : '<div style="aspect-ratio:2/3;background:var(--card)"></div>'}
          </div>
          <div class="dh-info">
            <div class="dh-type">${typeLabel}</div>
            <h1 class="dh-title">${esc(title).toUpperCase()}</h1>
            <div class="dh-meta">
              <span class="dm rating">â˜… ${rating}</span>
              <span class="dm">${year}</span>
              ${runtime ? `<span class="dm">${runtime}</span>` : ''}
              ${detail.status ? `<span class="dm">${detail.status}</span>` : ''}
              ${seasons.length ? `<span class="dm">${seasons.length} Sezon</span>` : ''}
              ${detail.number_of_episodes ? `<span class="dm">${detail.number_of_episodes} BÃ¶lÃ¼m</span>` : ''}
            </div>
            <div class="dh-genres-row">
              ${gs.map(g => `<span class="dh-genre" onclick="navigate('browse',{type:'${mediaType}',genreId:${g.id},title:'${esc(g.name).toUpperCase()}',sub:'${esc(g.name)} kategorisindeki iÃ§erikler',sortBy:'popularity.desc'})">${g.name}</span>`).join('')}
            </div>
            <p class="dh-overview">${esc(detail.overview || 'Bu iÃ§erik iÃ§in TÃ¼rkÃ§e aÃ§Ä±klama bulunamadÄ±.')}</p>
            ${director ? `<div class="dh-director"><span class="dh-dir-label">YÃ¶netmen</span> <span class="dh-dir-name">${esc(director)}</span></div>` : ''}
            <div class="dh-btns">
              <button class="btn-watch-big" onclick="startPlayer(${id},'${mediaType}',${firstSeason},${firstEp},${savedSeconds});window.scrollTo({top:0,behavior:'smooth'})">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><polygon points="5,3 19,12 5,21"/></svg>
                ÅžÄ°MDÄ° Ä°ZLE
              </button>
              ${trailerKey ? `<button class="btn-list" onclick="openTrailer('${trailerKey}','${esc(title)}')">
                <svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><polygon points="5,3 19,12 5,21"/></svg>
                Fragman
              </button>` : ''}
              <button class="btn-list ${inList ? 'added' : ''}" id="btnList" onclick="toggleWatchlist(${id},'${mediaType}','${esc(title)}','${detail.poster_path || ''}')">
                <svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                  ${inList ? '<polyline points="20 6 9 17 4 12"/>' : '<line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>'}
                </svg>
                ${inList ? 'Listede' : 'Listeme Ekle'}
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- SEASONS & EPISODES (only TV) -->
      ${seasons.length ? `
      <div class="seasons-section">
        <div class="seasons-title">SEZONLAR <span>& BÃ–LÃœMLER</span></div>
        <div class="season-tabs-row" id="seasonTabs">
          ${seasons.map((s, i) => `
            <button class="season-tab ${i === 0 ? 'active' : ''}"
              onclick="loadSeason(${id}, ${s.season_number}, this, ${JSON.stringify(s).replace(/"/g,'&quot;')})">
              Sezon ${s.season_number}
              <span style="margin-left:6px;font-size:11px;opacity:.6">(${s.episode_count})</span>
            </button>`).join('')}
        </div>
        <div id="seasonContent">
          <div class="ep-loading"><div class="spinner" style="width:28px;height:28px;margin:0 auto"></div></div>
        </div>
      </div>` : ''}

      <!-- CAST + INFO -->
      <div class="detail-body">
        <div class="detail-grid">
          <div class="detail-left">
            ${cast.length ? `
              <h3 style="font-family:'Bebas Neue',sans-serif;font-size:26px;letter-spacing:1.5px;margin-bottom:16px">OYUNCULAR</h3>
              <div class="cast-grid">
                ${cast.map(c => `
                  <div class="cast-item" onclick="navigate('person',{id:${c.id}})">
                    <img class="cast-img"
                      src="${c.profile_path ? 'https://image.tmdb.org/t/p/w92' + c.profile_path : ''}"
                      alt="${esc(c.name)}"
                      onerror="this.src='';this.style.background='var(--card2)'">
                    <span class="cast-name">${esc(c.name)}</span>
                    ${c.character ? `<span class="cast-char">${esc(c.character)}</span>` : ''}
                  </div>`).join('')}
              </div>` : ''}
          </div>
          <div class="detail-right">
            <div class="info-card">
              <h4>${mediaType === 'tv' ? 'Dizi Bilgileri' : 'Film Bilgileri'}</h4>
              ${[
                director ? ['YÃ¶netmen', director] : null,
                ['TÃ¼r', gs.map(g => g.name).join(', ')],
                ['YÄ±l', year],
                runtime ? ['SÃ¼re', runtime] : null,
                ['Puan', `â˜… ${rating} (${detail.vote_count?.toLocaleString()} oy)`],
                ['Durum', detail.status || ''],
                ['Dil', detail.original_language?.toUpperCase() || ''],
                seasons.length ? ['Sezon', seasons.length] : null,
                detail.number_of_episodes ? ['Toplam BÃ¶lÃ¼m', detail.number_of_episodes] : null,
                detail.budget > 0 ? ['BÃ¼tÃ§e', '$' + (detail.budget / 1e6).toFixed(0) + 'M'] : null,
                detail.revenue > 0 ? ['HasÄ±lat', '$' + (detail.revenue / 1e6).toFixed(0) + 'M'] : null,
                detail.production_companies?.[0] ? ['YapÄ±m', detail.production_companies[0].name] : null,
                detail.networks?.[0] ? ['Kanal', detail.networks[0].name] : null,
                detail.created_by?.length ? ['YaratÄ±cÄ±', detail.created_by.map(c=>c.name).join(', ')] : null,
              ].filter(Boolean).filter(r => r[1]).map(([k, v]) =>
                `<div class="info-row"><span class="ir-key">${k}</span><span class="ir-val">${esc(String(v))}</span></div>`
              ).join('')}
            </div>
            ${renderRatingWidget(id, mediaType, title, detail.poster_path||'')}
          </div>
        </div>
      </div>
      ${simItems.length ? `
        <div class="similar-sec">
          <div class="sec-head">
            <div>
              <div class="sec-title">BENZERÄ° <span>Ä°Ã‡ERÄ°KLER</span></div>
              <div class="sec-sub">Bunu beÄŸendiysen ÅŸunlara bak</div>
            </div>
          </div>
          <div class="h-scroll-wrap">
            <div class="h-scroll">${simItems.map(m => filmCardHtml(m, mediaType)).join('')}</div>
            <button class="scroll-btn left" onclick="scrollRowEl(this,-1)">&#8249;</button>
            <button class="scroll-btn right" onclick="scrollRowEl(this,1)">&#8250;</button>
          </div>
        </div>` : ''}
    `;

    // Auto-load first season for TV
    if (seasons.length) {
      loadSeason(id, seasons[0].season_number, document.querySelector('.season-tab'), seasons[0]);
      loadSidebarSeason(id, seasons[0].season_number); // Sidebar iÃ§in de yÃ¼kle
    }

    // Progress tracking listener
    initProgressTracking(id, mediaType);

  } catch(e) {
    el.innerHTML = '<div style="padding:80px;text-align:center;color:var(--muted)">Ä°Ã§erik yÃ¼klenirken hata oluÅŸtu.</div>';
  }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// SIDEBAR SEASON LOADER
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.loadSidebarSeason = async function(seriesId, seasonNum) {
  const list = document.getElementById('psSidebarEpList');
  if (!list) return;
  list.innerHTML = Array(6).fill(`<div class="ps-ep-item"><div class="ps-ep-thumb" style="background:var(--card2);border-radius:5px"></div><div style="flex:1;display:flex;flex-direction:column;gap:6px;justify-content:center"><div class="skeleton" style="height:10px;width:60%;border-radius:4px"></div><div class="skeleton" style="height:10px;width:80%;border-radius:4px"></div></div></div>`).join('');
  try {
    const data = await api(`/tv/${seriesId}/season/${seasonNum}`);
    const episodes = data.episodes || [];
    if (!episodes.length) { list.innerHTML = '<div style="padding:24px;text-align:center;color:var(--muted);font-size:13px">BÃ¶lÃ¼m bulunamadÄ±.</div>'; return; }
    list.innerHTML = episodes.map(ep => {
      const thumb = ep.still_path ? `https://image.tmdb.org/t/p/w300${ep.still_path}` : '';
      const runtime = ep.runtime ? `${ep.runtime}dk` : '';
      const rating = ep.vote_average ? `â˜… ${ep.vote_average.toFixed(1)}` : '';
      return `
        <div class="ps-ep-item" id="ps-ep-${seasonNum}-${ep.episode_number}" onclick="playEpisode(${seriesId},${seasonNum},${ep.episode_number},'${esc(ep.name||'')}')">
          ${thumb
            ? `<img class="ps-ep-thumb" src="${thumb}" alt="E${ep.episode_number}" loading="lazy" onerror="this.style.background='var(--card2)';this.removeAttribute('src')">`
            : `<div class="ps-ep-thumb" style="background:var(--card2);display:flex;align-items:center;justify-content:center;color:var(--muted);font-size:18px">â–¶</div>`}
          <div class="ps-ep-info">
            <div class="ps-ep-num">B${ep.episode_number}</div>
            <div class="ps-ep-name">${esc(ep.name||'BÃ¶lÃ¼m '+ep.episode_number)}</div>
            <div class="ps-ep-meta">${[runtime, rating].filter(Boolean).join(' Â· ')}</div>
          </div>
        </div>`;
    }).join('');
  } catch(e) {
    list.innerHTML = '<div style="padding:24px;text-align:center;color:var(--muted);font-size:13px">YÃ¼klenemedi.</div>';
  }
};

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// SEASON LOADER
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.loadSeason = async function(seriesId, seasonNum, tabEl, seasonMeta) {
  // Update active tab
  document.querySelectorAll('.season-tab').forEach(t => t.classList.remove('active'));
  if (tabEl) tabEl.classList.add('active');

  const container = document.getElementById('seasonContent');
  if (!container) return;

  // Show season info bar + loading
  const airYear = (seasonMeta?.air_date || '').slice(0, 4);
  const episodeCount = seasonMeta?.episode_count || '?';
  const seasonPoster = seasonMeta?.poster_path ? IMG_W + seasonMeta.poster_path : '';
  const seasonOverview = seasonMeta?.overview || '';
  const seasonName = seasonMeta?.name || `Sezon ${seasonNum}`;

  container.innerHTML = `
    <div class="season-info-bar">
      ${seasonPoster
        ? `<img class="season-poster" src="${seasonPoster}" alt="${esc(seasonName)}" onerror="this.style.display='none'">`
        : ''}
      <div class="season-info-text">
        <div class="si-name">${esc(seasonName)}</div>
        <div class="si-meta">
          ${airYear ? `<span>ðŸ“… ${airYear}</span>` : ''}
          <span>ðŸŽ¬ ${episodeCount} bÃ¶lÃ¼m</span>
        </div>
        ${seasonOverview ? `<div class="si-overview">${esc(seasonOverview)}</div>` : ''}
      </div>
    </div>
    <div class="episodes-list" id="episodesList">
      <div class="ep-loading"><div class="spinner" style="width:24px;height:24px;margin:0 auto"></div></div>
    </div>`;

  try {
    const data = await api(`/tv/${seriesId}/season/${seasonNum}`);
    const episodes = (data.episodes || []);
    const epList = document.getElementById('episodesList');
    if (!epList) return;

    if (!episodes.length) {
      epList.innerHTML = '<div style="padding:28px;text-align:center;color:var(--muted);font-size:14px">BÃ¶lÃ¼m bilgisi bulunamadÄ±.</div>';
      return;
    }

    epList.innerHTML = episodes.map((ep, i) => {
      const epRating = ep.vote_average ? ep.vote_average.toFixed(1) : null;
      const airDate = ep.air_date ? new Date(ep.air_date).toLocaleDateString('tr-TR', { day:'numeric', month:'long', year:'numeric' }) : '';
      const runtime = ep.runtime ? `${ep.runtime}dk` : '';
      const thumb = ep.still_path ? `https://image.tmdb.org/t/p/w300${ep.still_path}` : '';

      return `
        <div class="episode-card" style="animation-delay:${i * 0.03}s" onclick="playEpisode(${seriesId},${seasonNum},${ep.episode_number},'${esc(ep.name || '')}')">
          <div class="ep-num">${String(ep.episode_number).padStart(2,'0')}</div>
          <div class="ep-thumb-wrap">
            <img class="ep-thumb" src="${thumb}" alt="${esc(ep.name || '')}"
              onerror="this.style.background='var(--card2)';this.removeAttribute('src')">
            <div class="ep-play-icon">
              <svg width="22" height="22" viewBox="0 0 24 24" fill="var(--accent)"><polygon points="5,3 19,12 5,21"/></svg>
            </div>
          </div>
          <div class="ep-info">
            <div class="ep-title">${esc(ep.name || `${seasonNum}. Sezon ${ep.episode_number}. BÃ¶lÃ¼m`)}</div>
            <div class="ep-meta">
              ${airDate ? `<span>ðŸ“… ${airDate}</span>` : ''}
              ${runtime ? `<span>â± ${runtime}</span>` : ''}
            </div>
            ${ep.overview ? `<div class="ep-overview">${esc(ep.overview)}</div>` : ''}
          </div>
          ${epRating ? `<div class="ep-rating">â˜… ${epRating}</div>` : ''}
        </div>`;
    }).join('');

  } catch(e) {
    const epList = document.getElementById('episodesList');
    if (epList) epList.innerHTML = '<div style="padding:28px;text-align:center;color:var(--muted);font-size:14px">BÃ¶lÃ¼mler yÃ¼klenirken hata oluÅŸtu.</div>';
  }
};

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// VIDKING PLAYER
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const VIDKING = 'https://www.vidking.net';
const ACCENT_HEX = 'e8c840';

window.startPlayer = function(id, mediaType, season, episode, startSec) {


  const wrap = document.getElementById('playerWrap');
  if (!wrap) return;

  // Build Vidking URL
  let src;
  const params = new URLSearchParams({ color: ACCENT_HEX, autoPlay: 'true' });
  if (startSec > 10) params.set('progress', String(Math.floor(startSec)));

  if (mediaType === 'movie') {
    src = `${VIDKING}/embed/movie/${id}?${params}`;
  } else {
    params.set('nextEpisode', 'true');
    params.set('episodeSelector', 'true');
    src = `${VIDKING}/embed/tv/${id}/${season}/${episode}?${params}`;
  }

  // Remove splash, inject iframe
  wrap.innerHTML = `<iframe
    id="vidkingPlayer"
    class="player-iframe"
    src="${src}"
    allowfullscreen
    allow="autoplay; fullscreen; picture-in-picture"
    referrerpolicy="no-referrer-when-downgrade">
  </iframe>`;

  // Update controls label
  const title = currentDetail?.detail?.title || currentDetail?.detail?.name || '';
  const pcTitle = document.getElementById('pcTitle');
  if (pcTitle) {
    if (mediaType === 'tv') {
      pcTitle.textContent = `${title} â€” S${String(season).padStart(2,'0')} E${String(episode).padStart(2,'0')}`;
    } else {
      pcTitle.textContent = title;
    }
  }
};

window.playEpisode = function(seriesId, season, episode, name) {
  // Sidebar'da aktif bÃ¶lÃ¼mÃ¼ iÅŸaretle
  document.querySelectorAll('.ps-ep-item').forEach(el => el.classList.remove('active'));
  const activeEl = document.getElementById(`ps-ep-${season}-${episode}`);
  if (activeEl) { activeEl.classList.add('active'); activeEl.scrollIntoView({ block: 'nearest', behavior: 'smooth' }); }

  // Update splash label & controls
  const splashLabel = document.getElementById('splashEpLabel');
  if (splashLabel) splashLabel.textContent = `S${String(season).padStart(2,'0')} E${String(episode).padStart(2,'0')} â€” ${name}`;

  // Load saved progress for this episode
  const epKey = `cm_progress_tv_${seriesId}_s${season}e${episode}`;
  const saved = JSON.parse(localStorage.getItem(epKey) || 'null');
  const startSec = saved?.timestamp || 0;

  startPlayer(seriesId, 'tv', season, episode, startSec);
  window.scrollTo({ top: 0, behavior: 'smooth' });

  if (startSec > 10) {
    showToast(`S${String(season).padStart(2,'0')}E${String(episode).padStart(2,'0')} Â· KaldÄ±ÄŸÄ±n yerden devam ediliyor (${formatTime(startSec)})`);
  } else {
    showToast(`S${String(season).padStart(2,'0')}E${String(episode).padStart(2,'0')} Â· "${name}" baÅŸlatÄ±lÄ±yor ðŸŽ¬`);
  }
};

window.playContent = function(id, mediaType) {

  const progressKey = `cm_progress_${mediaType}_${id}`;
  const saved = JSON.parse(localStorage.getItem(progressKey) || 'null');
  const startSec = saved?.timestamp || 0;
  startPlayer(id, mediaType, saved?.season || 1, saved?.episode || 1, startSec);
  window.scrollTo({ top: 0, behavior: 'smooth' });
};

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// PROGRESS TRACKING
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function initProgressTracking(id, mediaType) {
  // Remove any previous listener
  if (window._progressHandler) window.removeEventListener('message', window._progressHandler);

  window._progressHandler = function(event) {
    if (typeof event.data !== 'string') return;
    let msg;
    try { msg = JSON.parse(event.data); } catch(e) { return; }
    if (msg.type !== 'PLAYER_EVENT') return;

    const d = msg.data;
    if (!d || !d.progress) return;

    // Update progress bar
    const fill = document.getElementById('progressBarFill');
    if (fill) fill.style.width = Math.min(d.progress, 100) + '%';

    // Update progress text
    const pcProg = document.getElementById('pcProgress');
    if (pcProg && d.currentTime) {
      pcProg.textContent = `${formatTime(d.currentTime)} / ${formatTime(d.duration)}`;
    }

    // Save to localStorage
    const baseKey = `cm_progress_${mediaType}_${id}`;
    const progressData = {
      progress: d.progress,
      timestamp: d.currentTime,
      duration: d.duration,
      updatedAt: Date.now(),
      season: d.season,
      episode: d.episode
    };
    localStorage.setItem(baseKey, JSON.stringify(progressData));

    // Update watch history
    const det = currentDetail?.detail;
    if (det) {
      const htitle = det.title || det.name || '';
      const hposter = det.poster_path || '';
      addToHistory(id, mediaType, htitle, hposter, d.progress);
    }

    // Also save per-episode key for TV
    if (mediaType === 'tv' && d.season && d.episode) {
      const epKey = `cm_progress_tv_${id}_s${d.season}e${d.episode}`;
      localStorage.setItem(epKey, JSON.stringify(progressData));

      // Update episode card progress indicator if visible
      const epCards = document.querySelectorAll('.episode-card');
      epCards.forEach(card => {
        const epNum = card.querySelector('.ep-num')?.textContent?.trim();
        if (epNum && parseInt(epNum) === d.episode) {
          let bar = card.querySelector('.ep-progress-bar');
          if (!bar) {
            bar = document.createElement('div');
            bar.className = 'ep-progress-bar';
            bar.style.cssText = 'height:2px;background:linear-gradient(to right,var(--accent),#f0a030);border-radius:0 0 0 0;position:absolute;bottom:0;left:0;transition:width .5s';
            card.style.position = 'relative';
            card.appendChild(bar);
          }
          bar.style.width = Math.min(d.progress, 100) + '%';
        }
      });

      // Show "watched" badge when complete
      if (d.event === 'ended' || d.progress >= 90) {
        showToast('BÃ¶lÃ¼m tamamlandÄ± âœ“');
      }
    } else if (d.event === 'ended' || d.progress >= 90) {
      showToast('Film tamamlandÄ± âœ“ Ä°yi seyirler! ðŸŽ¬');
    }
  };

  window.addEventListener('message', window._progressHandler);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// THEME
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.toggleTheme = function() {
  isDark = !isDark;
  document.body.classList.toggle('light', !isDark);
  localStorage.setItem('cm_theme', isDark ? 'dark' : 'light');
  updateThemeBtn();
};
function updateThemeBtn() {
  const b = document.getElementById('themeBtn');
  const mb = document.getElementById('mmThemeToggle');
  const label = isDark ? 'â˜€ï¸' : 'ðŸŒ™';
  const mlabel = isDark ? 'â˜€ï¸ AydÄ±nlÄ±k' : 'ðŸŒ™ KaranlÄ±k';
  if (b) b.textContent = label;
  if (mb) mb.textContent = mlabel;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// MOBILE MENU
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.openMobileMenu = function() {
  document.getElementById('mobileOverlay').classList.add('open');
  document.getElementById('mobileMenu').classList.add('open');
  document.body.style.overflow = 'hidden';
  // Update user section
  const mu = document.getElementById('mmUser');
  if (currentUser) {
    mu.innerHTML = `<div class="mu-avatar">${currentUser.avatar||currentUser.name[0].toUpperCase()}</div><div><div class="mu-name">${esc(currentUser.name)}</div><div class="mu-email">${esc(currentUser.email)}</div></div>`;
  } else {
    mu.innerHTML = `<button class="btn-primary" style="width:100%;font-size:14px" onclick="openAuth('login');closeMobileMenu()">GiriÅŸ Yap / Ãœye Ol</button>`;
  }
};
window.closeMobileMenu = function() {
  document.getElementById('mobileOverlay').classList.remove('open');
  document.getElementById('mobileMenu').classList.remove('open');
  document.body.style.overflow = '';
};

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// TRAILER MODAL
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.openTrailer = function(key, title) {
  document.getElementById('trailerTitleBar').textContent = 'ðŸŽ¬ ' + title + ' â€” Fragman';
  document.getElementById('trailerFrame').src = `https://www.youtube.com/embed/${key}?autoplay=1&rel=0&modestbranding=1`;
  openModal('trailerModal');
};
window.closeTrailer = function() {
  document.getElementById('trailerFrame').src = '';
  closeModal('trailerModal');
};

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// SEARCH PAGE
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function renderSearchPage(query) {
  const el = document.getElementById('page-search');
  if (!query) { el.innerHTML = '<div style="padding:80px;text-align:center;color:var(--muted)">Arama terimi giriniz.</div>'; return; }
  el.innerHTML = `
    <div class="search-page-header">
      <div class="search-page-query">"<span>${esc(query)}</span>" iÃ§in sonuÃ§lar</div>
      <div class="search-page-sub" id="searchPageSub">AranÄ±yor...</div>
    </div>
    <div class="search-filter-row">
      <button class="sf-btn active" id="sf-all" onclick="sfFilter('all',this,'${esc(query)}')">TÃ¼mÃ¼</button>
      <button class="sf-btn" id="sf-movie" onclick="sfFilter('movie',this,'${esc(query)}')">Filmler</button>
      <button class="sf-btn" id="sf-tv" onclick="sfFilter('tv',this,'${esc(query)}')">Diziler</button>
    </div>
    <div class="browse-content">
      <div class="film-grid" id="searchGrid"></div>
    </div>`;
  await sfFilter('all', document.getElementById('sf-all'), query);
}

window.sfFilter = async function(type, btn, query) {
  document.querySelectorAll('.sf-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  const grid = document.getElementById('searchGrid');
  const sub = document.getElementById('searchPageSub');
  if (!grid) return;
  grid.innerHTML = Array(12).fill(`<div class="skeleton" style="aspect-ratio:2/3;border-radius:12px"></div>`).join('');
  try {
    let results = [];
    if (type === 'all') {
      const d = await api('/search/multi', { query, page: 1 });
      results = d.results.filter(r => r.media_type !== 'person');
    } else {
      const d = await api('/search/' + type, { query, page: 1 });
      results = d.results.map(r => ({ ...r, media_type: type }));
    }
    const filtered = results.filter(r => r.poster_path || r.backdrop_path);
    if (sub) sub.textContent = filtered.length ? `${filtered.length} sonuÃ§ bulundu` : 'SonuÃ§ bulunamadÄ±';
    grid.innerHTML = filtered.length
      ? filtered.map(m => filmCardHtml(m, m.media_type === 'tv' ? 'tv' : 'movie')).join('')
      : `<div style="grid-column:1/-1;text-align:center;padding:80px 20px">
           <div style="font-size:48px;margin-bottom:16px">ðŸŽ¬</div>
           <div style="font-family:'Bebas Neue',sans-serif;font-size:28px;letter-spacing:2px;margin-bottom:12px">"${esc(query)}" Ä°Ã‡Ä°N SONUÃ‡ BULUNAMADI</div>
           <p style="color:var(--muted);font-size:14px;margin-bottom:24px">FarklÄ± bir arama terimi deneyin veya kategorilere gÃ¶z atÄ±n.</p>
           <button class="btn-sm" onclick="navigate('movies')">Filmlere GÃ¶z At</button>
           <button class="btn-sm" onclick="navigate('series')" style="margin-left:10px">Dizilere GÃ¶z At</button>
         </div>`;
  } catch(e) { grid.innerHTML = '<p style="color:var(--muted);padding:40px;grid-column:1/-1">Hata oluÅŸtu.</p>'; }
};

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// PROFILE PAGE
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const AVATARS = [
  { bg:'linear-gradient(135deg,#e8c840,#f0a030)', emoji:'â­' },
  { bg:'linear-gradient(135deg,#ff4f4f,#ff8c00)', emoji:'ðŸ”¥' },
  { bg:'linear-gradient(135deg,#3d9bff,#7b2fff)', emoji:'ðŸš€' },
  { bg:'linear-gradient(135deg,#00c9a7,#00a8cc)', emoji:'ðŸŒŠ' },
  { bg:'linear-gradient(135deg,#f953c6,#b91d73)', emoji:'ðŸ’«' },
  { bg:'linear-gradient(135deg,#43e97b,#38f9d7)', emoji:'ðŸŽ¯' },
  { bg:'linear-gradient(135deg,#fa8231,#f7b731)', emoji:'ðŸŽ¬' },
  { bg:'linear-gradient(135deg,#a29bfe,#6c5ce7)', emoji:'ðŸŽ­' },
];
let selectedAvatarIdx = parseInt(localStorage.getItem('cm_avatar') || '0');

function renderProfilePage() {
  const el = document.getElementById('page-profile');
  if (!currentUser) {
    el.innerHTML = `<div style="padding:140px 48px;text-align:center">
      <div style="font-size:60px;margin-bottom:20px">ðŸ‘¤</div>
      <h2 style="font-family:'Bebas Neue',sans-serif;font-size:36px;letter-spacing:2px;margin-bottom:12px">PROFÄ°LÄ°NE GÄ°RÄ°Åž YAP</h2>
      <p style="color:var(--muted);margin-bottom:28px">Profilini gÃ¶rmek iÃ§in giriÅŸ yapmalÄ±sÄ±n.</p>
      <button class="btn-primary" style="font-size:15px;padding:12px 28px" onclick="openAuth('login')">GiriÅŸ Yap</button>
    </div>`; return;
  }
  const av = AVATARS[selectedAvatarIdx];
  const totalWatched = watchHistory.length;
  const totalRated = Object.keys(userRatings).length;
  const totalList = watchlist.length;
  const ratingHistory = Object.entries(userRatings).slice(0,8).map(([key, val]) => {
    const [type, id] = key.split('_');
    const h = watchHistory.find(h => h.id == id) || {};
    return { key, type, id, rating: val, title: h.title || 'Bilinmeyen', poster: h.poster };
  });

  el.innerHTML = `
    <div class="profile-header">
      <div class="profile-avatar-wrap">
        <div class="profile-avatar" style="background:${av.bg}">${av.emoji}</div>
      </div>
      <div class="profile-info">
        <div class="p-name">${esc(currentUser.name)}</div>
        <div class="p-email">${esc(currentUser.email)}</div>
        <div class="profile-stats">
          <div class="ps-item"><div class="ps-num">${totalWatched}</div><div class="ps-lbl">Ä°zlenen</div></div>
          <div class="ps-item"><div class="ps-num">${totalRated}</div><div class="ps-lbl">Puanlanan</div></div>
          <div class="ps-item"><div class="ps-num">${totalList}</div><div class="ps-lbl">Listede</div></div>
        </div>
      </div>
    </div>
    <div class="profile-body">
      <div>
        <div class="profile-section-title">Ä°ZLEME <span>GEÃ‡MÄ°ÅžÄ°</span></div>
        ${watchHistory.length ? watchHistory.slice(0,20).map(h => `
          <div class="history-item" onclick="navigate('detail',{id:${h.id},mediaType:'${h.mediaType}'})">
            <img class="hi-poster" src="${h.poster ? IMG_W+h.poster : ''}" alt="${esc(h.title)}" onerror="this.style.background='var(--card2)'">
            <div class="hi-info">
              <div class="hi-title">${esc(h.title)}</div>
              <div class="hi-meta">${h.mediaType==='tv'?'Dizi':'Film'} Â· ${new Date(h.watchedAt).toLocaleDateString('tr-TR')}</div>
              <div class="hi-progress"><div class="hi-progress-fill" style="width:${Math.round(h.progress||0)}%"></div></div>
            </div>
            <div style="font-size:12px;color:var(--muted);flex-shrink:0">%${Math.round(h.progress||0)}</div>
          </div>`).join('')
        : '<p style="color:var(--muted);font-size:14px;padding:20px 0">HenÃ¼z izleme geÃ§miÅŸin yok.</p>'}

        ${ratingHistory.length ? `
          <div class="profile-section-title" style="margin-top:36px">PUANLA<span>DIKLARIM</span></div>
          ${ratingHistory.map(r => `
            <div class="rating-history-item" onclick="navigate('detail',{id:${r.id},mediaType:'${r.type}'})">
              <img class="rhi-poster" src="${r.poster ? IMG_W+r.poster : ''}" alt="${esc(r.title)}" onerror="this.style.background='var(--card2)'">
              <div class="rhi-info">
                <div class="rhi-title">${esc(r.title)}</div>
                <div class="rhi-meta">${r.type==='tv'?'Dizi':'Film'}</div>
              </div>
              <div class="rhi-stars">${'â˜…'.repeat(r.rating)}${'â˜†'.repeat(5-r.rating)}</div>
            </div>`).join('')}` : ''}
      </div>
      <div>
        <div class="profile-edit-card">
          <h4>Avatar SeÃ§</h4>
          <div class="avatar-grid" id="avatarGrid">
            ${AVATARS.map((a,i) => `
              <div class="avatar-opt ${i===selectedAvatarIdx?'selected':''}" style="background:${a.bg}" onclick="selectAvatar(${i})" data-idx="${i}">${a.emoji}</div>`).join('')}
          </div>
          <h4 style="margin-top:16px">Hesap</h4>
          <div style="font-size:14px;color:var(--muted);line-height:1.7;margin-bottom:16px">
            <strong style="color:var(--text)">${esc(currentUser.name)}</strong><br>
            ${esc(currentUser.email)}
          </div>
          <button class="btn-ghost" style="width:100%;justify-content:center" onclick="doLogout()">Ã‡Ä±kÄ±ÅŸ Yap</button>
        </div>
        <div class="profile-edit-card" style="margin-top:16px">
          <h4>Dil / Language</h4>
          <div style="display:flex;gap:8px;margin-top:4px">
            <button class="sf-btn ${localStorage.getItem('cm_lang')!=='en'?'active':''}" onclick="setLang('tr',this)">ðŸ‡¹ðŸ‡· TÃ¼rkÃ§e</button>
            <button class="sf-btn ${localStorage.getItem('cm_lang')==='en'?'active':''}" onclick="setLang('en',this)">ðŸ‡¬ðŸ‡§ English</button>
          </div>
        </div>
      </div>
    </div>`;
}

window.selectAvatar = function(idx) {
  selectedAvatarIdx = idx;
  localStorage.setItem('cm_avatar', idx);
  document.querySelectorAll('.avatar-opt').forEach((el,i) => el.classList.toggle('selected', i===idx));
  const av = AVATARS[idx];
  const pa = document.querySelector('.profile-avatar');
  if (pa) { pa.style.background = av.bg; pa.textContent = av.emoji; }
  const ua = document.getElementById('uAvatar');
  if (ua) { ua.style.background = av.bg; ua.textContent = av.emoji; }
  showToast('Avatar gÃ¼ncellendi âœ“');
};

window.setLang = function(lang, btn) {
  localStorage.setItem('cm_lang', lang);
  btn.closest('div').querySelectorAll('.sf-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  showToast(lang === 'tr' ? 'Dil TÃ¼rkÃ§e olarak ayarlandÄ± âœ“' : 'Language set to English âœ“');
};

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// CALENDAR PAGE
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function renderCalendarPage() {
  const el = document.getElementById('page-calendar');
  el.innerHTML = `
    <div class="browse-header">
      <div class="browse-title">DÄ°ZÄ° <span>TAKVÄ°MÄ°</span></div>
      <div class="browse-sub">Bu ay ve Ã¶nÃ¼mÃ¼zdeki gÃ¼nlerin yeni bÃ¶lÃ¼mleri</div>
    </div>
    <div class="sec" style="padding-top:24px">
      <div style="text-align:center;margin-bottom:24px">
        <div class="spinner" style="width:28px;height:28px;margin:0 auto"></div>
      </div>
      <div id="calendarContent"></div>
    </div>`;
  try {
    const now = new Date();
    const pad = n => String(n).padStart(2,'0');
    const from = `${now.getFullYear()}-${pad(now.getMonth()+1)}-01`;
    const last = new Date(now.getFullYear(), now.getMonth()+2, 0);
    const to = `${last.getFullYear()}-${pad(last.getMonth()+1)}-${pad(last.getDate())}`;
    const d = await api('/discover/tv', { sort_by:'popularity.desc', 'air_date.gte': from, 'air_date.lte': to, page:1 });
    const shows = d.results.slice(0,30);

    // Build calendar
    const today = new Date();
    const year = today.getFullYear();
    const month = today.getMonth();
    const firstDay = new Date(year, month, 1).getDay();
    const daysInMonth = new Date(year, month+1, 0).getDate();
    const monthNames = ['Ocak','Åžubat','Mart','Nisan','MayÄ±s','Haziran','Temmuz','AÄŸustos','EylÃ¼l','Ekim','KasÄ±m','AralÄ±k'];
    const dayNames = ['Paz','Pzt','Sal','Ã‡ar','Per','Cum','Cmt'];

    // Assign shows to random days for demo
    const calMap = {};
    shows.forEach((s,i) => {
      const day = (i*3 % daysInMonth) + 1;
      if (!calMap[day]) calMap[day] = [];
      calMap[day].push(s);
    });

    let calHTML = `<h3 style="font-family:'Bebas Neue',sans-serif;font-size:28px;letter-spacing:2px;color:#fff;margin-bottom:20px">${monthNames[month].toUpperCase()} ${year}</h3>`;
    calHTML += '<div class="calendar-grid">';
    calHTML += dayNames.map(d => `<div class="cal-day-header">${d}</div>`).join('');

    // Empty cells before first day
    for (let i = 0; i < firstDay; i++) calHTML += '<div class="cal-day other-month"></div>';

    for (let d = 1; d <= daysInMonth; d++) {
      const isToday = d === today.getDate();
      const eps = calMap[d] || [];
      calHTML += `<div class="cal-day ${isToday?'today':''}">
        <div class="cal-day-num">${d}</div>
        ${eps.slice(0,2).map((s,i) => `<div class="cal-ep ${i===1?'tv3':''}" onclick="navigate('detail',{id:${s.id},mediaType:'tv'})" title="${esc(s.name)}">${esc(s.name)}</div>`).join('')}
      </div>`;
    }
    calHTML += '</div>';

    // Upcoming list
    calHTML += `<div class="profile-section-title" style="margin-top:36px">YAKLAÅžAN <span>YENÄ° BÃ–LÃœMLER</span></div>`;
    calHTML += '<div class="upcoming-list">';
    calHTML += shows.slice(0,15).map((s,i) => {
      const day = (i*3 % daysInMonth) + 1;
      const mn = monthNames[month].slice(0,3);
      const isNew = i < 3;
      return `<div class="upcoming-item" onclick="navigate('detail',{id:${s.id},mediaType:'tv'})">
        <div class="ui-date"><div class="ui-day">${pad(day)}</div><div class="ui-month">${mn}</div></div>
        <img class="ui-poster" src="${s.poster_path ? IMG_W+s.poster_path : ''}" alt="${esc(s.name)}" onerror="this.style.display='none'">
        <div class="ui-info">
          <div class="ui-show">${esc(s.name)}</div>
          <div class="ui-ep">Yeni BÃ¶lÃ¼m Â· â˜… ${s.vote_average?.toFixed(1)||'â€”'}</div>
        </div>
        <span class="ui-badge ${isNew?'new':'soon'}">${isNew?'YENÄ°':'YAKINDA'}</span>
      </div>`;
    }).join('');
    calHTML += '</div>';

    document.getElementById('calendarContent').innerHTML = calHTML;
  } catch(e) {
    document.getElementById('calendarContent').innerHTML = '<p style="color:var(--muted);padding:40px;text-align:center">Takvim yÃ¼klenirken hata oluÅŸtu.</p>';
  }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// PERSON PAGE
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function renderPersonPage(personId) {
  const el = document.getElementById('page-person');
  el.innerHTML = '<div class="spinner" style="margin-top:200px"></div>';
  try {
    const [person, credits] = await Promise.all([
      api(`/person/${personId}`),
      api(`/person/${personId}/combined_credits`)
    ]);
    const movies = (credits.cast || []).filter(m => m.poster_path).sort((a,b) => (b.popularity||0)-(a.popularity||0)).slice(0,20);
    el.innerHTML = `
      <div class="person-header">
        <img class="person-photo" src="${person.profile_path ? 'https://image.tmdb.org/t/p/w185'+person.profile_path : ''}" alt="${esc(person.name)}" onerror="this.style.display='none'">
        <div class="person-info">
          <div class="person-name">${esc(person.name)}</div>
          <div class="person-dept">${person.known_for_department || 'Oyuncu'}</div>
          <p class="person-bio">${esc(person.biography || 'Biyografi bulunamadÄ±.')}</p>
          <div class="person-meta-grid">
            ${person.birthday ? `<div class="pm-item"><strong>DoÄŸum</strong>${new Date(person.birthday).toLocaleDateString('tr-TR',{day:'numeric',month:'long',year:'numeric'})}</div>` : ''}
            ${person.place_of_birth ? `<div class="pm-item"><strong>DoÄŸum Yeri</strong>${esc(person.place_of_birth)}</div>` : ''}
            ${person.deathday ? `<div class="pm-item"><strong>Ã–lÃ¼m</strong>${new Date(person.deathday).toLocaleDateString('tr-TR',{day:'numeric',month:'long',year:'numeric'})}</div>` : ''}
          </div>
        </div>
      </div>
      <div class="sec">
        <div class="sec-title" style="margin-bottom:20px">FÄ°LMOGRAFÄ° <span>(${movies.length})</span></div>
        <div class="film-grid">${movies.map(m => filmCardHtml(m, m.media_type||'movie')).join('')}</div>
      </div>`;
  } catch(e) {
    el.innerHTML = '<div style="padding:80px;text-align:center;color:var(--muted)">KiÅŸi bilgileri yÃ¼klenirken hata oluÅŸtu.</div>';
  }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// 404 PAGE
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function render404() {
  const el = document.getElementById('page-404');
  el.innerHTML = `<div class="page-404">
    <div class="p404-num">404</div>
    <div class="p404-title">SAYFA BULUNAMADI</div>
    <p class="p404-sub">AradÄ±ÄŸÄ±n sayfa mevcut deÄŸil ya da taÅŸÄ±nmÄ±ÅŸ olabilir.</p>
    <button class="btn-play" onclick="navigate('home')">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M3 12l9-9 9 9M5 10v9h5v-6h4v6h5v-9"/></svg>
      ANA SAYFAYA DÃ–N
    </button>
  </div>`;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// DMCA SAYFASI
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderDmcaPage() {
  const el = document.getElementById('page-dmca');
  const today = new Date().toLocaleDateString('tr-TR', { year:'numeric', month:'long', day:'numeric' });
  el.innerHTML = `
    <div style="max-width:860px;margin:0 auto;padding:80px 40px 120px">

      <!-- BaÅŸlÄ±k -->
      <div style="margin-bottom:48px">
        <div style="font-size:11px;letter-spacing:3px;color:var(--accent);font-weight:600;margin-bottom:12px">HUKUKÄ° BÄ°LDÄ°RÄ°M</div>
        <h1 style="font-family:'Bebas Neue',sans-serif;font-size:52px;letter-spacing:2px;margin-bottom:16px">DMCA POLÄ°TÄ°KASI</h1>
        <p style="color:var(--muted);font-size:14px">Son gÃ¼ncelleme: ${today}</p>
      </div>

      <!-- UyarÄ± kutusu -->
      <div style="background:linear-gradient(135deg,rgba(229,9,20,.08),rgba(229,9,20,.03));border:1px solid rgba(229,9,20,.25);border-radius:12px;padding:24px 28px;margin-bottom:48px">
        <div style="font-size:13px;font-weight:600;color:var(--accent);letter-spacing:1px;margin-bottom:8px">âš ï¸ Ã–NEMLÄ° UYARI</div>
        <p style="font-size:14px;line-height:1.75;color:rgba(232,234,240,.8);margin:0">
          Ne Ä°zlesen, herhangi bir film veya dizi iÃ§eriÄŸini sunucularÄ±nda barÄ±ndÄ±rmamaktadÄ±r. Platformumuz yalnÄ±zca Ã¼Ã§Ã¼ncÃ¼ taraf kaynaklara baÄŸlantÄ± saÄŸlayan bir arama ve dizinleme hizmetidir. TÃ¼m iÃ§erikler harici kaynaklardan gÃ¶mÃ¼lerek sunulmaktadÄ±r.
        </p>
      </div>

      ${[
        {
          num: '01',
          title: 'Platformumuzun NiteliÄŸi',
          content: `Ne Ä°zlesen ("Platform"), kullanÄ±cÄ±larÄ±n film ve dizi iÃ§eriklerine eriÅŸmesine olanak tanÄ±yan bir arama motoru ve iÃ§erik dizinleme hizmetidir. Platform, hiÃ§bir iÃ§eriÄŸi kendi sunucularÄ±nda depolamaz, yÃ¼klemez veya yayÄ±nlamaz. Sitede yer alan tÃ¼m iÃ§erikler; The Movie Database (TMDB) API'si aracÄ±lÄ±ÄŸÄ±yla meta verisi Ã§ekilen ve baÄŸÄ±msÄ±z Ã¼Ã§Ã¼ncÃ¼ taraf barÄ±ndÄ±rma platformlarÄ±ndan gÃ¶mÃ¼len medyalardÄ±r. Bu nedenle Platform, bir "internet servis saÄŸlayÄ±cÄ±sÄ±" statÃ¼sÃ¼nde olup DMCA'nÄ±n 512(c) maddesi kapsamÄ±ndaki "gÃ¼venli liman" (safe harbor) korumasÄ±ndan yararlanmaktadÄ±r.`
        },
        {
          num: '02',
          title: 'Telif HakkÄ± Ä°hlali Bildirimi (DMCA Takedown)',
          content: `Telif hakkÄ±na sahip olduÄŸunuz veya temsil ettiÄŸiniz bir iÃ§eriÄŸin platformumuz Ã¼zerinden eriÅŸilebilir hale getirildiÄŸini dÃ¼ÅŸÃ¼nÃ¼yorsanÄ±z, aÅŸaÄŸÄ±daki bilgileri iÃ§eren yazÄ±lÄ± bir bildirim gÃ¶nderebilirsiniz. DMCA kapsamÄ±nda geÃ§erli bir bildirim ÅŸu unsurlarÄ± iÃ§ermelidir:<br><br>
          <div style="background:var(--card);border-radius:10px;padding:20px 24px;margin-top:12px">
            ${[
              ['1.', 'Ä°hlal edildiÄŸini iddia ettiÄŸiniz telif hakkÄ±na sahip eserin aÃ§Ä±k tanÄ±mÄ±'],
              ['2.', 'Ä°hlal ettiÄŸini dÃ¼ÅŸÃ¼ndÃ¼ÄŸÃ¼nÃ¼z iÃ§eriÄŸin platformumuzdaki tam URL\'si veya konumu'],
              ['3.', 'Sizi veya temsil ettiÄŸiniz kurumu tanÄ±mlamaya yetecek iletiÅŸim bilgileriniz (ad, adres, telefon, e-posta)'],
              ['4.', 'SÃ¶z konusu kullanÄ±mÄ±n telif hakkÄ± sahibi, temsilcisi veya kanun tarafÄ±ndan yetkilendirilmediÄŸine dair iyi niyetli beyan'],
              ['5.', 'Bildirimde yer alan bilgilerin doÄŸru olduÄŸuna ve telif hakkÄ± sahibi adÄ±na hareket etme yetkisine sahip olduÄŸunuza dair yeminli beyan'],
              ['6.', 'Bildirimin imzasÄ± (fiziksel veya elektronik)'],
            ].map(([n,t]) => `<div style="display:flex;gap:12px;margin-bottom:14px;font-size:14px;line-height:1.6"><span style="color:var(--accent);font-weight:600;flex-shrink:0">${n}</span><span style="color:rgba(232,234,240,.75)">${t}</span></div>`).join('')}
          </div>`
        },
        {
          num: '03',
          title: 'Bildirim GÃ¶nderme Adresi',
          content: `DMCA bildirimlerinizi aÅŸaÄŸÄ±daki adrese iletebilirsiniz:<br><br>
          <div style="background:var(--card);border-radius:10px;padding:20px 24px;display:grid;gap:10px">
            <div style="font-size:14px;color:rgba(232,234,240,.75)">ðŸ“§ <strong style="color:var(--text)">E-posta:</strong> dmca@neizlesen.com</div>
            <div style="font-size:14px;color:rgba(232,234,240,.75)">â± <strong style="color:var(--text)">YanÄ±t sÃ¼resi:</strong> GeÃ§erli bildirimlere 72 saat iÃ§inde yanÄ±t verilir</div>
            <div style="font-size:14px;color:rgba(232,234,240,.75)">ðŸŒ <strong style="color:var(--text)">Platform:</strong> neizlesen.com</div>
          </div>`
        },
        {
          num: '04',
          title: 'Ä°ÅŸlem SÃ¼reci',
          content: `GeÃ§erli bir DMCA bildirimi aldÄ±ÄŸÄ±mÄ±zda ÅŸu adÄ±mlarÄ± izleriz:<br><br>
          <div style="background:var(--card);border-radius:10px;padding:20px 24px;margin-top:12px">
            ${[
              ['72 saat iÃ§inde', 'Bildirimi inceleyerek ilgili iÃ§eriÄŸe platformumuzdan eriÅŸimi devre dÄ±ÅŸÄ± bÄ±rakÄ±r ya da kaldÄ±rÄ±rÄ±z'],
              ['5 iÅŸ gÃ¼nÃ¼ iÃ§inde', 'Ä°Ã§erik saÄŸlayÄ±cÄ±sÄ±na durumu bildiririz'],
              ['10-14 gÃ¼n iÃ§inde', 'Ä°Ã§erik saÄŸlayÄ±cÄ±sÄ±ndan itiraz gelmesi halinde hukuki sÃ¼reÃ§ baÅŸlatÄ±lÄ±r'],
            ].map(([s,t]) => `<div style="display:flex;gap:16px;margin-bottom:14px;font-size:14px;line-height:1.6;align-items:flex-start"><span style="color:var(--accent);font-weight:600;flex-shrink:0;min-width:140px">${s}</span><span style="color:rgba(232,234,240,.75)">${t}</span></div>`).join('')}
          </div>`
        },
        {
          num: '05',
          title: 'KarÅŸÄ± Bildirim (Counter-Notice)',
          content: `KaldÄ±rÄ±lan iÃ§eriÄŸin kendi orijinal eseriniz olduÄŸunu veya kaldÄ±rmanÄ±n hatalÄ± yapÄ±ldÄ±ÄŸÄ±nÄ± dÃ¼ÅŸÃ¼nÃ¼yorsanÄ±z, DMCA 512(g) kapsamÄ±nda karÅŸÄ± bildirim gÃ¶nderme hakkÄ±nÄ±z bulunmaktadÄ±r. KarÅŸÄ± bildiriminiz aynÄ± iletiÅŸim adresine gÃ¶nderilebilir. GeÃ§erli bir karÅŸÄ± bildirim aldÄ±ÄŸÄ±mÄ±zda, bildiren tarafÄ± 10 iÅŸ gÃ¼nÃ¼ iÃ§inde bilgilendiririz; bildiren tarafÄ±n bu sÃ¼re iÃ§inde mahkeme kararÄ± almamasÄ± durumunda iÃ§erik yeniden eriÅŸime aÃ§Ä±labilir.`
        },
        {
          num: '06',
          title: 'Tekrarlayan Ä°hlalciler PolitikasÄ±',
          content: `Ne Ä°zlesen, telif hakkÄ± ihlalini tekrarlayan kullanÄ±cÄ±larÄ±n hesaplarÄ±nÄ± uygun durumlarda askÄ±ya alma veya sonlandÄ±rma politikasÄ±nÄ± benimsemiÅŸtir. Bu politika, DMCA'nÄ±n 512(i) maddesi kapsamÄ±ndaki gerekliliklere uyum amacÄ±yla uygulanmaktadÄ±r.`
        },
        {
          num: '07',
          title: 'Sorumluluk Reddi',
          content: `Platform, Ã¼Ã§Ã¼ncÃ¼ taraf iÃ§eriklerin telif hakkÄ± durumunu Ã¶nceden denetleme yÃ¼kÃ¼mlÃ¼lÃ¼ÄŸÃ¼ taÅŸÄ±mamaktadÄ±r. KullanÄ±cÄ±larÄ±n platformumuzu aracÄ±lÄ±ÄŸÄ±yla ulaÅŸtÄ±ÄŸÄ± harici siteler ve bu sitelerdeki iÃ§erikler, sÃ¶z konusu sitelerin kendi sorumluluÄŸundadÄ±r. Ne Ä°zlesen, yalnÄ±zca iyi niyet ilkesi Ã§erÃ§evesinde geÃ§erli bildirimlere hÄ±zla yanÄ±t vermeyi taahhÃ¼t eder.`
        },
      ].map(s => `
        <div style="margin-bottom:48px">
          <div style="display:flex;align-items:center;gap:16px;margin-bottom:18px">
            <span style="font-family:'Bebas Neue',sans-serif;font-size:36px;color:var(--accent);opacity:.4;line-height:1">${s.num}</span>
            <h2 style="font-family:'Bebas Neue',sans-serif;font-size:24px;letter-spacing:1.5px">${s.title}</h2>
          </div>
          <div style="font-size:15px;line-height:1.85;color:rgba(232,234,240,.75);padding-left:52px">${s.content}</div>
        </div>
      `).join('')}

      <!-- Alt bilgi -->
      <div style="border-top:1px solid var(--border);padding-top:32px;margin-top:16px;display:flex;justify-content:space-between;align-items:center;flex-wrap:gap">
        <p style="font-size:13px;color:var(--muted);margin:0">Bu politika herhangi bir bildirim yapÄ±lmaksÄ±zÄ±n deÄŸiÅŸtirilebilir.</p>
        <button class="btn-sm" onclick="navigate('home')" style="margin-top:0">â† Ana Sayfa</button>
      </div>
    </div>
  `;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// STAR RATING & REVIEW
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderRatingWidget(id, mediaType, title, poster) {
  const key = `${mediaType}_${id}`;
  const existing = userRatings[key] || 0;
  const existingReview = (userReviews[key] || []).find(r => r.userId === currentUser?.email);
  const allReviews = (userReviews[key] || []).slice(0,5);
  return `
    <div class="rating-widget">
      <h4>Puan Ver</h4>
      <div class="star-rating" id="starRow_${id}">
        ${[1,2,3,4,5].map(n => `<span class="star ${n<=existing?'active':''}" data-val="${n}" onclick="setRating(${id},'${mediaType}','${esc(title)}','${poster}',${n})" onmouseover="hoverStars(${id},${n})" onmouseout="unhoverStars(${id},${existing})">â˜…</span>`).join('')}
      </div>
      ${existing ? `<div style="font-size:12px;color:var(--accent);margin-top:8px">PuanÄ±n: ${existing}/5 â˜…</div>` : '<div style="font-size:12px;color:var(--muted);margin-top:8px">Bu iÃ§eriÄŸi puanla</div>'}
      ${currentUser ? `
        <textarea class="review-input" id="reviewInput_${id}" placeholder="Yorum yaz (isteÄŸe baÄŸlÄ±)...">${existingReview?.text||''}</textarea>
        <button class="btn-sm" style="margin-top:10px;font-size:14px" onclick="submitReview(${id},'${mediaType}','${esc(title)}','${poster}')">
          ${existingReview ? 'GÃœNCELLE' : 'YORUM PAYLAÅž'}
        </button>` : ''}
      ${allReviews.length ? `
        <div class="review-list">
          ${allReviews.map(r => `
            <div class="review-item">
              <div class="ri-header">
                <div class="ri-avatar">${r.userName[0].toUpperCase()}</div>
                <span class="ri-name">${esc(r.userName)}</span>
                <span class="ri-date">${new Date(r.date).toLocaleDateString('tr-TR')}</span>
              </div>
              <div class="ri-stars">${'â˜…'.repeat(r.rating)}${'â˜†'.repeat(5-r.rating)}</div>
              ${r.text ? `<div class="ri-text" style="margin-top:6px">${esc(r.text)}</div>` : ''}
            </div>`).join('')}
        </div>` : ''}
    </div>`;
}

window.hoverStars = function(id, val) {
  document.querySelectorAll(`#starRow_${id} .star`).forEach((s,i) => s.classList.toggle('active', i<val));
};
window.unhoverStars = function(id, current) {
  document.querySelectorAll(`#starRow_${id} .star`).forEach((s,i) => s.classList.toggle('active', i<current));
};
window.setRating = function(id, mediaType, title, poster, val) {
  if (!currentUser) { showToast('Puanlamak iÃ§in giriÅŸ yap!', true); openAuth('login'); return; }
  const key = `${mediaType}_${id}`;
  userRatings[key] = val;
  localStorage.setItem('cm_ratings', JSON.stringify(userRatings));
  document.querySelectorAll(`#starRow_${id} .star`).forEach((s,i) => s.classList.toggle('active', i<val));
  const sub = document.querySelector(`#starRow_${id}`).nextElementSibling;
  if (sub) { sub.style.color = 'var(--accent)'; sub.textContent = `PuanÄ±n: ${val}/5 â˜…`; }
  addToHistory(id, mediaType, title, poster, 0);
  showToast(`${val}/5 â˜… puanÄ± kaydedildi âœ“`);
};
window.submitReview = function(id, mediaType, title, poster) {
  if (!currentUser) return;
  const key = `${mediaType}_${id}`;
  const text = document.getElementById(`reviewInput_${id}`)?.value.trim() || '';
  const rating = userRatings[key] || 3;
  const reviews = userReviews[key] || [];
  const existing = reviews.findIndex(r => r.userId === currentUser.email);
  const review = { userId: currentUser.email, userName: currentUser.name, rating, text, date: Date.now() };
  if (existing >= 0) reviews[existing] = review; else reviews.unshift(review);
  userReviews[key] = reviews;
  localStorage.setItem('cm_reviews', JSON.stringify(userReviews));
  showToast('Yorumun paylaÅŸÄ±ldÄ± âœ“');
};

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// WATCH HISTORY
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function addToHistory(id, mediaType, title, poster, progress) {
  const idx = watchHistory.findIndex(h => h.id === id && h.mediaType === mediaType);
  const item = { id, mediaType, title, poster, progress, watchedAt: Date.now() };
  if (idx >= 0) watchHistory[idx] = item; else watchHistory.unshift(item);
  if (watchHistory.length > 50) watchHistory = watchHistory.slice(0,50);
  localStorage.setItem('cm_history', JSON.stringify(watchHistory));
}

function initHistory() {
  // Rewire progress tracking to also update watch history
  const origHandler = window._progressHandler;
  // Will be initialized per-detail page, nothing to do here globally
}

function formatTime(sec) {
  if (!sec) return '0:00';
  const h = Math.floor(sec / 3600);
  const m = Math.floor((sec % 3600) / 60);
  const s = Math.floor(sec % 60);
  if (h > 0) return `${h}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
  return `${m}:${String(s).padStart(2,'0')}`;
}
window.toggleWatchlist = function(id, mediaType, title, poster) {
  if (!currentUser) { showToast('Listeye eklemek iÃ§in giriÅŸ yap!', true); openAuth('login'); return; }
  const idx = watchlist.findIndex(w => w.id === id && w.mediaType === mediaType);
  if (idx >= 0) {
    watchlist.splice(idx, 1);
    showToast(`"${title}" listeden Ã§Ä±karÄ±ldÄ±.`);
  } else {
    watchlist.push({ id, mediaType, title, poster, addedAt: Date.now() });
    showToast(`"${title}" listene eklendi âœ“`);
  }
  localStorage.setItem('cm_watchlist', JSON.stringify(watchlist));
  const btn = document.getElementById('btnList');
  if (btn) {
    const inList = watchlist.some(w => w.id === id && w.mediaType === mediaType);
    btn.className = 'btn-list' + (inList?' added':'');
    btn.innerHTML = `<svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">${inList?'<polyline points="20 6 9 17 4 12"/>':'<line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>'}</svg>${inList?'Listede':'Listeme Ekle'}`;
  }
};

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// MY LIST
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderMyList() {
  const el = document.getElementById('page-mylist');
  if (!currentUser) {
    el.innerHTML = `<div style="padding:140px 48px;text-align:center">
      <div style="font-size:60px;margin-bottom:20px">ðŸŽ¬</div>
      <h2 style="font-family:'Bebas Neue',sans-serif;font-size:36px;letter-spacing:2px;margin-bottom:12px">LÄ°STENÄ° OLUÅžTUR</h2>
      <p style="color:var(--muted);margin-bottom:28px">Ä°zlemek istediÄŸin iÃ§erikleri kaydetmek iÃ§in giriÅŸ yap.</p>
      <button class="btn-primary" style="font-size:15px;padding:12px 28px" onclick="openAuth('login')">GiriÅŸ Yap</button>
    </div>`;
    return;
  }
  if (watchlist.length === 0) {
    el.innerHTML = `<div style="padding:140px 48px;text-align:center">
      <div style="font-size:60px;margin-bottom:20px">ðŸ“‹</div>
      <h2 style="font-family:'Bebas Neue',sans-serif;font-size:36px;letter-spacing:2px;margin-bottom:12px">LÄ°STEN BOÅž</h2>
      <p style="color:var(--muted);margin-bottom:28px">Film ve dizi sayfalarÄ±ndaki + butonunu kullanarak buraya ekle.</p>
      <button class="btn-primary" style="font-size:15px;padding:12px 28px" onclick="navigate('home')">KeÅŸfet</button>
    </div>`;
    return;
  }
  el.innerHTML = `
    <div class="browse-header">
      <div class="browse-title">LÄ°STE<span>LERÄ°M</span></div>
      <div class="browse-sub">${watchlist.length} iÃ§erik kaydedildi</div>
    </div>
    <div class="browse-content">
      <div class="film-grid">${watchlist.map(w => `
        <div class="film-card" onclick="navigate('detail',{id:${w.id},mediaType:'${w.mediaType}'})">
          <div class="fc-wrap">
            <img class="fc-img" src="${w.poster ? IMG_W+w.poster : ''}" alt="${esc(w.title)}" onerror="this.style.display='none'">
            <div class="fc-badge ${w.mediaType==='tv'?'fc-new':''}">HD</div>
            <div class="fc-overlay"><div class="fc-play"><svg width="18" height="18" viewBox="0 0 24 24" fill="#07090e"><polygon points="5,3 19,12 5,21"/></svg></div></div>
          </div>
          <div class="fc-info">
            <div class="fc-title">${esc(w.title)}</div>
            <div class="fc-meta"><span>${w.mediaType==='tv'?'Dizi':'Film'}</span></div>
          </div>
        </div>`).join('')}
      </div>
    </div>`;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// CARD HTML
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function filmCardHtml(m, mediaType) {
  const title = m.title || m.name || '';
  const year = (m.release_date || m.first_air_date || '').slice(0,4);
  const rating = m.vote_average ? m.vote_average.toFixed(1) : 'â€”';
  const isNew = year >= '2024';
  return `
    <div class="film-card" onclick="navigate('detail',{id:${m.id},mediaType:'${mediaType}'})">
      <div class="fc-wrap">
        ${m.poster_path
          ? `<img class="fc-img" src="${IMG_W}${m.poster_path}" alt="${esc(title)}" loading="lazy">`
          : `<div class="fc-img" style="background:linear-gradient(135deg,#1a1a2e,#16213e);display:flex;align-items:center;justify-content:center;font-family:'Bebas Neue',sans-serif;font-size:14px;color:rgba(255,255,255,0.3);text-align:center;padding:12px">${esc(title).toUpperCase()}</div>`
        }
        <div class="fc-badge ${isNew?'fc-new':''}">${isNew?'YENÄ°':'HD'}</div>
        <div class="fc-rating">â˜… ${rating}</div>
        <div class="fc-overlay"><div class="fc-play"><svg width="18" height="18" viewBox="0 0 24 24" fill="#07090e"><polygon points="5,3 19,12 5,21"/></svg></div></div>
      </div>
      <div class="fc-info">
        <div class="fc-title">${esc(title)}</div>
        <div class="fc-meta"><span>${year}</span><span>Â·</span><span>${(m.genre_ids||[]).slice(0,1).map(id=>genres[id]||'').join('')||'Ä°Ã§erik'}</span></div>
      </div>
    </div>`;
}

// Series card (wide)
function seriesCardHtml(s, badge='POPÃœLER', badgeCls='pop') {
  const title = s.name || s.original_name || '';
  const rating = s.vote_average ? s.vote_average.toFixed(1) : 'â€”';
  const year = (s.first_air_date || '').slice(0,4);
  return `
    <div class="series-card" onclick="navigate('detail',{id:${s.id},mediaType:'tv'})">
      ${s.backdrop_path
        ? `<img class="sc-img" src="${IMG_M}${s.backdrop_path}" alt="${esc(title)}" loading="lazy">`
        : `<div class="sc-img" style="background:linear-gradient(135deg,#0d1b2a,#1b2838)"></div>`}
      <div class="sc-grad">
        <div class="sc-title">${esc(title)}</div>
        <div class="sc-meta"><span class="s-rating">â˜… ${rating}</span><span>Â·</span><span>${year}</span></div>
      </div>
      <div class="sc-badge ${badgeCls}">${badge}</div>
      <div class="sc-play"><svg width="20" height="20" viewBox="0 0 24 24" fill="#07090e"><polygon points="5,3 19,12 5,21"/></svg></div>
    </div>`;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// SEARCH
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function initSearch() {
  const input = document.getElementById('searchInput');
  const drop = document.getElementById('searchDrop');
  let timer;
  let isMouseDownOnDrop = false;

  input.addEventListener('focus', () => {
    if (document.getElementById('sugList').children.length) drop.style.display = 'block';
  });
  input.addEventListener('blur', () => {
    if (!isMouseDownOnDrop) drop.style.display = 'none';
  });
  drop.addEventListener('mousedown', (e) => {
    isMouseDownOnDrop = true;
    const item = e.target.closest('.sug-item');
    if (item) { e.preventDefault(); item.click(); }
  });
  drop.addEventListener('mouseup', () => { isMouseDownOnDrop = false; });

  input.addEventListener('input', e => {
    clearTimeout(timer);
    const q = e.target.value.trim();
    if (!q || q.length < 2) {
      document.getElementById('sugList').innerHTML = '<div style="padding:16px;text-align:center;color:var(--muted);font-size:13px">Aramak iÃ§in yazÄ±n...</div>';
      drop.style.display = 'none';
      return;
    }
    drop.style.display = 'block';
    timer = setTimeout(() => doSearch(q), 320);
  });

  // Enter â†’ full search page
  input.addEventListener('keydown', e => {
    if (e.key === 'Enter') {
      const q = input.value.trim();
      if (q) {
        drop.style.display = 'none';
        input.blur();
        navigate('search', { query: q });
      }
    }
    if (e.key === 'Escape') { drop.style.display = 'none'; input.blur(); }
  });

  document.addEventListener('click', (e) => {
    if (!e.target.closest('.search-wrap')) drop.style.display = 'none';
  });
}

// Watch history tracker â€” called on page init
function initHistory() {
  // History tracking happens in detail page when user starts playback
}

async function doSearch(q) {
  const drop = document.getElementById('searchDrop');
  const sugList = document.getElementById('sugList');
  sugList.innerHTML = '<div style="padding:16px;text-align:center"><div class="spinner" style="width:24px;height:24px;margin:0 auto"></div></div>';
  drop.style.display = 'block';
  try {
    const d = await api('/search/multi', { query: q, page: 1 });
    const items = d.results.filter(x => x.media_type !== 'person' && (x.poster_path || x.backdrop_path)).slice(0, 8);
    if (!items.length) {
      sugList.innerHTML = '<div style="padding:16px;text-align:center;color:var(--muted);font-size:13px">SonuÃ§ bulunamadÄ±.</div>';
      return;
    }
    sugList.innerHTML = items.map(m => {
      const title = m.title || m.name || '';
      const year = (m.release_date || m.first_air_date || '').slice(0, 4);
      const type = m.media_type === 'tv' ? 'tv' : 'movie';
      const typeLabel = type === 'tv' ? 'DÄ°ZÄ°' : 'FÄ°LM';
      const typeCls = type === 'tv' ? 'dizi' : 'film';
      return `<div class="sug-item" data-id="${m.id}" data-type="${type}">
        <img class="sug-poster" src="${m.poster_path ? IMG_W + m.poster_path : ''}" alt="" onerror="this.style.display='none'">
        <div class="sug-info">
          <div class="sug-title">${esc(title)}</div>
          <div class="sug-meta">${year}</div>
        </div>
        <span class="sug-type ${typeCls}">${typeLabel}</span>
      </div>`;
    }).join('');

    // Attach click handlers properly
    sugList.querySelectorAll('.sug-item').forEach(item => {
      item.addEventListener('click', () => {
        const id = parseInt(item.dataset.id);
        const type = item.dataset.type;
        drop.style.display = 'none';
        document.getElementById('searchInput').value = '';
        document.getElementById('searchInput').blur();
        navigate('detail', { id, mediaType: type });
      });
    });

  } catch(e) {
    sugList.innerHTML = '<div style="padding:16px;color:var(--muted);font-size:13px">Hata oluÅŸtu.</div>';
  }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// AUTH
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.openAuth = function(tab) { openModal('authModal'); switchAuth(tab); };
window.switchAuth = function(tab) {
  document.getElementById('amLogin').style.display = tab==='login' ? 'block' : 'none';
  document.getElementById('amReg').style.display = tab==='register' ? 'block' : 'none';
  document.getElementById('amTabLogin').classList.toggle('active', tab==='login');
  document.getElementById('amTabReg').classList.toggle('active', tab==='register');
  document.getElementById('amSub').textContent = tab==='login' ? 'HesabÄ±na giriÅŸ yap' : 'Yeni hesap oluÅŸtur';
  document.getElementById('amErr').style.display = 'none';
};

window.doLogin = function() {
  const email = document.getElementById('lEmail').value.trim();
  const pass = document.getElementById('lPass').value;
  if (!email || !pass) { showAmErr('LÃ¼tfen tÃ¼m alanlarÄ± doldurun.'); return; }
  const users = JSON.parse(localStorage.getItem('cm_users') || '[]');
  const u = users.find(u => u.email === email && u.password === btoa(pass));
  if (!u) { showAmErr('E-posta veya ÅŸifre hatalÄ±.'); return; }
  authSuccess(u);
};

window.doRegister = function() {
  const name = document.getElementById('rName').value.trim();
  const email = document.getElementById('rEmail').value.trim();
  const pass = document.getElementById('rPass').value;
  if (!name || !email || !pass) { showAmErr('LÃ¼tfen tÃ¼m alanlarÄ± doldurun.'); return; }
  if (pass.length < 6) { showAmErr('Åžifre en az 6 karakter olmalÄ±dÄ±r.'); return; }
  if (!/\S+@\S+\.\S+/.test(email)) { showAmErr('GeÃ§erli bir e-posta girin.'); return; }
  const users = JSON.parse(localStorage.getItem('cm_users') || '[]');
  if (users.find(u => u.email === email)) { showAmErr('Bu e-posta zaten kayÄ±tlÄ±.'); return; }
  const u = { name, email, password: btoa(pass), avatar: name[0].toUpperCase() };
  users.push(u);
  localStorage.setItem('cm_users', JSON.stringify(users));
  authSuccess(u);
};

function authSuccess(u) {
  currentUser = u;
  localStorage.setItem('cm_user', JSON.stringify(u));
  closeModal('authModal');
  updateAuthUI();
  showToast(`HoÅŸ geldin, ${u.name}! ðŸŽ¬`);
}

window.doLogout = function() {
  currentUser = null;
  localStorage.removeItem('cm_user');
  updateAuthUI();
  showToast('Ã‡Ä±kÄ±ÅŸ yapÄ±ldÄ±.');
  if (currentPage === 'mylist') navigate('home');
};

function updateAuthUI() {
  document.getElementById('authBtns').style.display = currentUser ? 'none' : 'flex';
  document.getElementById('userChip').style.display = currentUser ? 'flex' : 'none';
  if (currentUser) document.getElementById('uAvatar').textContent = currentUser.avatar || currentUser.name[0].toUpperCase();
}

function showAmErr(msg) {
  const el = document.getElementById('amErr');
  el.textContent = msg; el.style.display = 'block';
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// MODALS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.openModal = function(id) { document.getElementById(id).classList.add('open'); document.body.style.overflow='hidden'; };
window.closeModal = function(id) { document.getElementById(id).classList.remove('open'); document.body.style.overflow=''; };
document.querySelectorAll('.modal-overlay').forEach(o => o.addEventListener('click', e => { if(e.target===o) closeModal(o.id); }));
document.addEventListener('keydown', e => { if(e.key==='Escape') document.querySelectorAll('.modal-overlay.open').forEach(o=>closeModal(o.id)); });

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// UTILS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.scrollRow = function(id, dir) {
  const el = document.getElementById(id);
  if (el) el.scrollBy({ left: dir * 520, behavior: 'smooth' });
};
window.scrollRowEl = function(btn, dir) {
  const wrap = btn.closest('.h-scroll-wrap');
  const scroll = wrap?.querySelector('.h-scroll');
  if (scroll) scroll.scrollBy({ left: dir * 520, behavior: 'smooth' });
};

function showToast(msg, isErr=false) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.className = 'toast' + (isErr?' err':'');
  void t.offsetWidth;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 3400);
}

function esc(s) {
  return String(s || '').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;');
}

// CURSOR
function initCursor() {
  const dot = document.getElementById('cursorDot');
  const ring = document.getElementById('cursorRing');
  let mx=0, my=0, rx=0, ry=0;
  document.addEventListener('mousemove', e => {
    mx = e.clientX; my = e.clientY;
    dot.style.left = mx+'px'; dot.style.top = my+'px';
  });
  function anim() {
    rx += (mx-rx)*.11; ry += (my-ry)*.11;
    ring.style.left = rx+'px'; ring.style.top = ry+'px';
    requestAnimationFrame(anim);
  }
  anim();
  document.addEventListener('mouseover', e => {
    if (e.target.closest('a,button,.film-card,.series-card,.tab-btn,.cat-btn,.sug-item,.featured-banner,.dh-genre')) {
      ring.style.width='50px'; ring.style.height='50px'; ring.style.borderColor='rgba(232,200,64,.75)';
    }
  });
  document.addEventListener('mouseout', e => {
    if (e.target.closest('a,button,.film-card,.series-card,.tab-btn,.cat-btn,.sug-item,.featured-banner,.dh-genre')) {
      ring.style.width='36px'; ring.style.height='36px'; ring.style.borderColor='rgba(232,200,64,.45)';
    }
  });
}

// SCROLL
function initScroll() {
  window.addEventListener('scroll', () => {
    document.getElementById('nav').classList.toggle('scrolled', window.scrollY > 60);
    const pct = (window.scrollY / Math.max(1, document.body.scrollHeight - window.innerHeight)) * 100;
    document.getElementById('scrollProg').style.width = pct + '%';
  });
}
</script>
</body>
</html>
