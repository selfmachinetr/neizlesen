<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Ne Ä°zlesen</title>

<style>
:root{
  --bg:#0b0f17;
  --panel:#111827;
  --accent:#7c5cff;
  --text:#e5e7eb;
  --muted:#9ca3af;
}
body{
  margin:0;
  font-family:system-ui,Segoe UI,Roboto;
  background:var(--bg);
  color:var(--text);
}
header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:16px 24px;
  border-bottom:1px solid #1f2937;
}
h1{margin:0;font-size:20px}
input{
  background:#020617;
  border:1px solid #1f2937;
  color:white;
  padding:10px 12px;
  border-radius:8px;
  width:260px;
}
.grid{
  padding:20px;
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(160px,1fr));
  gap:14px;
}
.card{
  background:var(--panel);
  border-radius:12px;
  overflow:hidden;
  cursor:pointer;
  border:1px solid #1f2937;
}
.card img{
  width:100%;
  aspect-ratio:2/3;
  object-fit:cover;
}
.title{
  padding:8px;
  font-size:13px;
}
dialog{
  border:0;
  width:min(1000px,95vw);
  background:#020617;
  color:white;
  border-radius:12px;
}
.modal{
  display:grid;
  grid-template-columns:260px 1fr;
  gap:16px;
  padding:16px;
}
.modal img{width:100%;border-radius:10px}
iframe{
  width:100%;
  aspect-ratio:16/9;
  border:0;
  border-radius:10px;
}
select{
  background:#020617;
  border:1px solid #1f2937;
  color:white;
  padding:6px;
  border-radius:6px;
}
button{
  background:var(--accent);
  border:0;
  padding:8px 12px;
  border-radius:8px;
  color:white;
  cursor:pointer;
}
.close{
  position:absolute;
  right:12px;
  top:12px;
  background:#111827;
}
</style>
</head>

<body>

<header>
  <h1>ðŸŽ¬ Ne Ä°zlesen</h1>
  <input id="search" placeholder="Film veya dizi ara">
</header>

<div class="grid" id="grid"></div>

<dialog id="modal">
  <button class="close" onclick="modal.close()">âœ•</button>
  <div class="modal" id="modalContent"></div>
</dialog>

<script>
const API="https://api.themoviedb.org/3";
const KEY="4b19cfb150897a9071d51539b2ffc42f";
const IMG="https://image.tmdb.org/t/p/w500";

const grid=document.getElementById("grid");
const modal=document.getElementById("modal");
const modalContent=document.getElementById("modalContent");
const search=document.getElementById("search");

async function fetchTrending(){
  const r=await fetch(`${API}/trending/all/week?api_key=${KEY}&language=tr`);
  const j=await r.json();
  render(j.results);
}

function render(list){
  grid.innerHTML=list.map(x=>{
    const title=x.title||x.name;
    const poster=x.poster_path?IMG+x.poster_path:"";
    return `
    <div class="card" onclick="openDetails(${x.id},'${x.media_type}')">
      <img src="${poster}">
      <div class="title">${title}</div>
    </div>`;
  }).join("");
}

async function openDetails(id,type){
  const r=await fetch(`${API}/${type}/${id}?api_key=${KEY}&language=tr`);
  const d=await r.json();

  const title=d.title||d.name;
  const poster=d.poster_path?IMG+d.poster_path:"";
  const overview=d.overview||"AÃ§Ä±klama yok";

  if(type==="movie"){
    modalContent.innerHTML=`
      <img src="${poster}">
      <div>
        <h2>${title}</h2>
        <p>${overview}</p>
        <iframe src="https://vidlink.pro/movie/${id}" allowfullscreen></iframe>
      </div>
    `;
  }else{
    modalContent.innerHTML=`
      <img src="${poster}">
      <div>
        <h2>${title}</h2>
        <p>${overview}</p>

        <div>
          Sezon:
          <select id="season"></select>
          BÃ¶lÃ¼m:
          <select id="episode"></select>
          <button onclick="loadEpisode(${id})">Ä°zle</button>
        </div>

        <iframe id="player"></iframe>
      </div>
    `;

    const seasonSel=document.getElementById("season");
    const epSel=document.getElementById("episode");

    d.seasons.filter(s=>s.season_number>0).forEach(s=>{
      seasonSel.innerHTML+=`<option value="${s.season_number}">${s.season_number}</option>`;
    });

    seasonSel.onchange=()=>loadEpisodes(id,seasonSel.value);
    loadEpisodes(id,seasonSel.value||1);
  }

  modal.showModal();
}

async function loadEpisodes(id,season){
  const epSel=document.getElementById("episode");
  const r=await fetch(`${API}/tv/${id}/season/${season}?api_key=${KEY}&language=tr`);
  const d=await r.json();
  epSel.innerHTML="";
  d.episodes.forEach(e=>{
    epSel.innerHTML+=`<option value="${e.episode_number}">${e.episode_number}</option>`;
  });
}

function loadEpisode(id){
  const s=document.getElementById("season").value;
  const e=document.getElementById("episode").value;
  document.getElementById("player").src=`https://vidlink.pro/tv/${id}/${s}/${e}`;
}

search.oninput=async()=>{
  const q=search.value.trim();
  if(!q){fetchTrending();return;}
  const r=await fetch(`${API}/search/multi?api_key=${KEY}&query=${q}&language=tr`);
  const j=await r.json();
  render(j.results.filter(x=>x.media_type!=="person"));
};

fetchTrending();
</script>

</body>
</html>
