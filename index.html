<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Ne ƒ∞zlesen</title>

<style>
:root{
  --bg:#0b0f17;
  --panel:#111827;
  --accent:#e50914;
  --text:#e5e7eb;
  --muted:#9ca3af;
}
body{margin:0;font-family:system-ui;background:var(--bg);color:var(--text)}
header{
  display:flex;justify-content:space-between;align-items:center;
  padding:16px 24px;border-bottom:1px solid #1f2937
}
h1{margin:0;font-size:20px}
.row{margin:18px 0}
.row h2{margin:0 0 8px 16px;font-size:16px}
.scroller{
  display:flex;gap:10px;overflow-x:auto;padding:0 16px 10px
}
.card{
  min-width:150px;background:var(--panel);
  border-radius:8px;overflow:hidden;cursor:pointer;
  border:1px solid #1f2937
}
.card img{width:100%;aspect-ratio:2/3;object-fit:cover}
.card .t{padding:6px;font-size:12px}
dialog{
  border:0;width:min(1000px,95vw);background:#020617;
  color:white;border-radius:12px
}
.modal{display:grid;grid-template-columns:260px 1fr;gap:16px;padding:16px}
.modal img{width:100%;border-radius:10px}
iframe{width:100%;aspect-ratio:16/9;border:0;border-radius:10px}
button{
  background:var(--accent);border:0;padding:8px 12px;
  border-radius:6px;color:white;cursor:pointer
}
.topbar{display:flex;gap:10px;align-items:center}
input{
  background:#020617;border:1px solid #1f2937;color:white;
  padding:8px;border-radius:6px
}
.badge{
  background:#111827;border:1px solid #1f2937;
  padding:4px 6px;border-radius:6px;font-size:12px
}
</style>
</head>

<body>

<header>
  <h1>üé¨ Ne ƒ∞zlesen</h1>
  <div class="topbar">
    <input id="search" placeholder="Ara">
    <span id="user"></span>
    <button onclick="logout()">√áƒ±kƒ±≈ü</button>
  </div>
</header>

<div id="app"></div>

<dialog id="modal">
  <div class="modal" id="modalContent"></div>
</dialog>

<script>
const API="https://api.themoviedb.org/3";
const KEY="4b19cfb150897a9071d51539b2ffc42f";
const IMG="https://image.tmdb.org/t/p/w500";

const app=document.getElementById("app");
const modal=document.getElementById("modal");
const modalContent=document.getElementById("modalContent");
const userSpan=document.getElementById("user");
const search=document.getElementById("search");

function save(key,val){localStorage.setItem(key,JSON.stringify(val))}
function load(key){return JSON.parse(localStorage.getItem(key)||"[]")}

function login(){
  let u=localStorage.getItem("user");
  if(!u){
    u=prompt("Profil adƒ±:");
    localStorage.setItem("user",u);
  }
  userSpan.textContent="üë§ "+u;
}
function logout(){
  localStorage.removeItem("user");
  location.reload();
}

function favs(){return load("favs")}
function addFav(x){
  let f=favs();
  if(!f.find(i=>i.id==x.id)){
    f.push(x);
    save("favs",f);
  }
}

function cont(){return load("continue")}
function addContinue(x){
  let c=cont();
  c=c.filter(i=>i.id!=x.id);
  c.unshift(x);
  save("continue",c.slice(0,20));
}

async function tmdb(url){
  const r=await fetch(url);
  return await r.json();
}

function card(x){
  const title=x.title||x.name;
  return `
  <div class="card" onclick="openItem(${x.id},'${x.media_type}')">
    <img src="${IMG+x.poster_path}">
    <div class="t">${title}</div>
  </div>`;
}

function row(title,list){
  return `
  <div class="row">
    <h2>${title}</h2>
    <div class="scroller">
      ${list.map(card).join("")}
    </div>
  </div>`;
}

async function loadHome(){
  const trend=await tmdb(`${API}/trending/all/week?api_key=${KEY}&language=tr`);
  const topTR=await tmdb(`${API}/discover/movie?api_key=${KEY}&region=TR&sort_by=popularity.desc`);

  let html="";
  const c=cont();
  const f=favs();

  if(c.length) html+=row("ƒ∞zlemeye Devam Et",c);
  if(f.length) html+=row("Favorilerim",f);

  html+=row("Top10 T√ºrkiye",topTR.results.slice(0,10));
  html+=row("Trend",trend.results);

  app.innerHTML=html;
}

async function openItem(id,type){
  const d=await tmdb(`${API}/${type}/${id}?api_key=${KEY}&language=tr`);
  const title=d.title||d.name;
  const poster=d.poster_path?IMG+d.poster_path:"";

  modalContent.innerHTML=`
    <img src="${poster}">
    <div>
      <h2>${title}</h2>
      <p>${d.overview||""}</p>

      <button onclick='play(${id},"${type}")'>‚ñ∂ ƒ∞zle</button>
      <button onclick='fav(${id},"${type}")'>‚ù§ Favori</button>

      <iframe id="player"></iframe>
    </div>
  `;
  modal.showModal();
}

function fav(id,type){
  addFav({id,media_type:type});
  alert("Favorilere eklendi");
}

function play(id,type){
  const p=document.getElementById("player");
  if(type==="movie"){
    p.src=`https://vidlink.pro/movie/${id}`;
  }else{
    p.src=`https://vidlink.pro/tv/${id}/1/1`;
  }
  addContinue({id,media_type:type});
}

search.oninput=async()=>{
  const q=search.value.trim();
  if(!q){loadHome();return;}
  const r=await tmdb(`${API}/search/multi?api_key=${KEY}&query=${q}&language=tr`);
  app.innerHTML=row("Sonu√ßlar",r.results.filter(x=>x.media_type!="person"));
}

login();
loadHome();
</script>

</body>
</html>
